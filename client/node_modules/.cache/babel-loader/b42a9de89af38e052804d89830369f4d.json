{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\src\\\\components\\\\TimeslotsList.js\";\nimport React from \"react\";\nimport axios from \"axios\";\nimport PropTypes from \"prop-types\";\nimport moment from \"moment\";\nimport Texts from \"../Constants/Texts\";\nimport withLanguage from \"./LanguageContext\";\nimport FilterTimeslotsDrawer from \"./FilterTimeslotsDrawer\";\nimport TimeslotPreview from \"./TimeslotPreview\";\nimport Log from \"./Log\";\n\nvar getUsersChildren = function getUsersChildren(userId) {\n  return axios.get(\"/api/users/\".concat(userId, \"/children\")).then(function (response) {\n    return response.data;\n  }).catch(function (error) {\n    Log.error(error);\n    return [];\n  });\n};\n\nvar handleTimeslots = function handleTimeslots(timeslots, usersChildren) {\n  var userId = JSON.parse(localStorage.getItem(\"user\")).id;\n  var sortedTimeslots = timeslots.sort(function (a, b) {\n    return moment.utc(a.start.dateTime).diff(moment.utc(b.start.dateTime));\n  });\n\n  for (var j = 0; j < sortedTimeslots.length; j += 1) {\n    var parents = JSON.parse(sortedTimeslots[j].extendedProperties.shared.parents);\n    sortedTimeslots[j].userSubscribed = parents.includes(userId);\n    var children = JSON.parse(sortedTimeslots[j].extendedProperties.shared.children);\n    sortedTimeslots[j].childrenSubscribed = false;\n\n    for (var i = 0; i < usersChildren.length; i += 1) {\n      if (children.includes(usersChildren[i].child_id)) {\n        sortedTimeslots[j].childrenSubscribed = true;\n        break;\n      }\n    }\n  }\n\n  return sortedTimeslots;\n};\n\nvar TimeslotsList = /*#__PURE__*/function (_React$Component) {\n  _inherits(TimeslotsList, _React$Component);\n\n  var _super = _createSuper(TimeslotsList);\n\n  function TimeslotsList() {\n    var _this;\n\n    _classCallCheck(this, TimeslotsList);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      dates: [],\n      filter: \"all\",\n      filterDrawerVisible: false,\n      timeslots: [],\n      usersChildren: []\n    };\n\n    _this.handleFilterDrawerVisibility = function () {\n      var filterDrawerVisible = _this.state.filterDrawerVisible;\n\n      _this.setState({\n        filterDrawerVisible: !filterDrawerVisible\n      });\n    };\n\n    _this.handleFilterDrawerClick = function (filterOption) {\n      _this.setState({\n        filter: filterOption,\n        filterDrawerVisible: false\n      });\n    };\n\n    _this.handleFilterDrawerClose = function () {\n      _this.setState({\n        filterDrawerVisible: false\n      });\n    };\n\n    _this.enoughParticipants = function (timeslot) {\n      var extendedProperties = timeslot.extendedProperties.shared;\n\n      if (JSON.parse(extendedProperties.parents).length >= extendedProperties.requiredParents && JSON.parse(extendedProperties.children).length >= extendedProperties.requiredChildren) {\n        return true;\n      }\n\n      return false;\n    };\n\n    _this.filterTimeslot = function (timeslot) {\n      var _this$state = _this.state,\n          filter = _this$state.filter,\n          usersChildren = _this$state.usersChildren;\n      var parents = JSON.parse(timeslot.extendedProperties.shared.parents);\n      var children = JSON.parse(timeslot.extendedProperties.shared.children);\n      var userId = JSON.parse(localStorage.getItem(\"user\")).id;\n\n      switch (filter) {\n        case \"all\":\n          return true;\n\n        case \"enough\":\n          return _this.enoughParticipants(timeslot);\n\n        case \"notEnough\":\n          return !_this.enoughParticipants(timeslot);\n\n        case \"mySigned\":\n          return parents.indexOf(userId) !== -1;\n\n        case \"myChildrenSigned\":\n          return usersChildren.filter(function (c) {\n            return children.indexOf(c.child_id) !== -1;\n          }).length > 0;\n\n        default:\n          return true;\n      }\n    };\n\n    _this.renderTimeslots = function (timeslots) {\n      return /*#__PURE__*/React.createElement(\"ul\", {\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 7\n        }\n      }, timeslots.map(function (timeslot, timeslotIndex) {\n        return /*#__PURE__*/React.createElement(\"li\", {\n          key: timeslotIndex,\n          style: {\n            margin: \"1rem 0\"\n          },\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(TimeslotPreview, {\n          timeslot: timeslot,\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 15\n          }\n        }));\n      }));\n    };\n\n    _this.renderDays = function () {\n      var _this$state2 = _this.state,\n          dates = _this$state2.dates,\n          timeslots = _this$state2.timeslots;\n      return /*#__PURE__*/React.createElement(\"ul\", {\n        id: \"timeslotDayContainer\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 7\n        }\n      }, dates.map(function (date, index) {\n        var dayTimeslots = timeslots.filter(function (timeslot) {\n          return moment(date).format(\"D\") === moment(timeslot.start.dateTime).format(\"D\") && _this.filterTimeslot(timeslot);\n        });\n        return dayTimeslots.length > 0 && /*#__PURE__*/React.createElement(\"li\", {\n          key: index,\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"row no-gutters\",\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"col-2-10\",\n          style: {\n            paddingTop: \"1.5rem\"\n          },\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"timeslotDay\",\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 21\n          }\n        }, moment(date).format(\"D\")), /*#__PURE__*/React.createElement(\"div\", {\n          className: \"timeslotDay\",\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 21\n          }\n        }, moment(date).format(\"MMM\"))), /*#__PURE__*/React.createElement(\"div\", {\n          className: \"col-8-10\",\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 19\n          }\n        }, _this.renderTimeslots(dayTimeslots))));\n      }));\n    };\n\n    return _this;\n  }\n\n  _createClass(TimeslotsList, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var userId, usersChildren, _this$props, timeslots, dates;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                userId = JSON.parse(localStorage.getItem(\"user\")).id;\n                _context.next = 3;\n                return getUsersChildren(userId);\n\n              case 3:\n                usersChildren = _context.sent;\n                _this$props = this.props, timeslots = _this$props.timeslots, dates = _this$props.dates;\n                this.setState({\n                  usersChildren: usersChildren,\n                  timeslots: handleTimeslots(timeslots, usersChildren),\n                  dates: dates\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var language = this.props.language;\n      var _this$state3 = this.state,\n          filterDrawerVisible = _this$state3.filterDrawerVisible,\n          filter = _this$state3.filter;\n      var texts = Texts[language].timeslotsList;\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(FilterTimeslotsDrawer, {\n        isOpen: filterDrawerVisible,\n        handleFilterDrawerClick: this.handleFilterDrawerClick,\n        activeOption: filter,\n        handleFilterDrawerClose: this.handleFilterDrawerClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        id: \"timeslotsListContainer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row no-gutters filterLabel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"transparentButton\",\n        onClick: this.handleFilterDrawerVisibility,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 13\n        }\n      }, \"\".concat(texts[filter], \"  \"), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fas fa-chevron-down\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 15\n        }\n      }))), this.renderDays()));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, prevState) {\n      if (nextProps.timeslots.length !== prevState.timeslots.length) {\n        var timeslots = handleTimeslots(nextProps.timeslots, prevState.usersChildren);\n        return {\n          timeslots: timeslots,\n          dates: nextProps.dates\n        };\n      }\n\n      return null;\n    }\n  }]);\n\n  return TimeslotsList;\n}(React.Component);\n\nexport default withLanguage(TimeslotsList);\nTimeslotsList.propTypes = {\n  dates: PropTypes.array,\n  timeslots: PropTypes.array,\n  language: PropTypes.string\n};","map":{"version":3,"sources":["C:/Users/nucle/Documents/GitHub/Families_Share-platform/client/src/components/TimeslotsList.js"],"names":["React","axios","PropTypes","moment","Texts","withLanguage","FilterTimeslotsDrawer","TimeslotPreview","Log","getUsersChildren","userId","get","then","response","data","catch","error","handleTimeslots","timeslots","usersChildren","JSON","parse","localStorage","getItem","id","sortedTimeslots","sort","a","b","utc","start","dateTime","diff","j","length","parents","extendedProperties","shared","userSubscribed","includes","children","childrenSubscribed","i","child_id","TimeslotsList","state","dates","filter","filterDrawerVisible","handleFilterDrawerVisibility","setState","handleFilterDrawerClick","filterOption","handleFilterDrawerClose","enoughParticipants","timeslot","requiredParents","requiredChildren","filterTimeslot","indexOf","c","renderTimeslots","map","timeslotIndex","margin","renderDays","date","index","dayTimeslots","format","paddingTop","props","language","texts","timeslotsList","nextProps","prevState","Component","propTypes","array","string"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport axios from \"axios\";\r\nimport PropTypes from \"prop-types\";\r\nimport moment from \"moment\";\r\nimport Texts from \"../Constants/Texts\";\r\nimport withLanguage from \"./LanguageContext\";\r\nimport FilterTimeslotsDrawer from \"./FilterTimeslotsDrawer\";\r\nimport TimeslotPreview from \"./TimeslotPreview\";\r\nimport Log from \"./Log\";\r\n\r\nconst getUsersChildren = userId => {\r\n  return axios\r\n    .get(`/api/users/${userId}/children`)\r\n    .then(response => {\r\n      return response.data;\r\n    })\r\n    .catch(error => {\r\n      Log.error(error);\r\n      return [];\r\n    });\r\n};\r\n\r\nconst handleTimeslots = (timeslots, usersChildren) => {\r\n  const userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n  const sortedTimeslots = timeslots.sort((a, b) => {\r\n    return moment.utc(a.start.dateTime).diff(moment.utc(b.start.dateTime));\r\n  });\r\n  for (let j = 0; j < sortedTimeslots.length; j += 1) {\r\n    const parents = JSON.parse(\r\n      sortedTimeslots[j].extendedProperties.shared.parents\r\n    );\r\n    sortedTimeslots[j].userSubscribed = parents.includes(userId);\r\n    const children = JSON.parse(\r\n      sortedTimeslots[j].extendedProperties.shared.children\r\n    );\r\n    sortedTimeslots[j].childrenSubscribed = false;\r\n    for (let i = 0; i < usersChildren.length; i += 1) {\r\n      if (children.includes(usersChildren[i].child_id)) {\r\n        sortedTimeslots[j].childrenSubscribed = true;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return sortedTimeslots;\r\n};\r\n\r\nclass TimeslotsList extends React.Component {\r\n  state = {\r\n    dates: [],\r\n    filter: \"all\",\r\n    filterDrawerVisible: false,\r\n    timeslots: [],\r\n    usersChildren: []\r\n  };\r\n\r\n  static getDerivedStateFromProps(nextProps, prevState) {\r\n    if (nextProps.timeslots.length !== prevState.timeslots.length) {\r\n      const timeslots = handleTimeslots(\r\n        nextProps.timeslots,\r\n        prevState.usersChildren\r\n      );\r\n      return {\r\n        timeslots,\r\n        dates: nextProps.dates\r\n      };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async componentDidMount() {\r\n    const userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n    const usersChildren = await getUsersChildren(userId);\r\n    const { timeslots, dates } = this.props;\r\n    this.setState({\r\n      usersChildren,\r\n      timeslots: handleTimeslots(timeslots, usersChildren),\r\n      dates\r\n    });\r\n  }\r\n\r\n  handleFilterDrawerVisibility = () => {\r\n    const { filterDrawerVisible } = this.state;\r\n    this.setState({ filterDrawerVisible: !filterDrawerVisible });\r\n  };\r\n\r\n  handleFilterDrawerClick = filterOption => {\r\n    this.setState({ filter: filterOption, filterDrawerVisible: false });\r\n  };\r\n\r\n  handleFilterDrawerClose = () => {\r\n    this.setState({ filterDrawerVisible: false });\r\n  };\r\n\r\n  enoughParticipants = timeslot => {\r\n    const extendedProperties = timeslot.extendedProperties.shared;\r\n    if (\r\n      JSON.parse(extendedProperties.parents).length >=\r\n        extendedProperties.requiredParents &&\r\n      JSON.parse(extendedProperties.children).length >=\r\n        extendedProperties.requiredChildren\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  filterTimeslot = timeslot => {\r\n    const { filter, usersChildren } = this.state;\r\n    const parents = JSON.parse(timeslot.extendedProperties.shared.parents);\r\n    const children = JSON.parse(timeslot.extendedProperties.shared.children);\r\n    const userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n\r\n    switch (filter) {\r\n      case \"all\":\r\n        return true;\r\n      case \"enough\":\r\n        return this.enoughParticipants(timeslot);\r\n      case \"notEnough\":\r\n        return !this.enoughParticipants(timeslot);\r\n      case \"mySigned\":\r\n        return parents.indexOf(userId) !== -1;\r\n      case \"myChildrenSigned\":\r\n        return (\r\n          usersChildren.filter(c => children.indexOf(c.child_id) !== -1)\r\n            .length > 0\r\n        );\r\n      default:\r\n        return true;\r\n    }\r\n  };\r\n\r\n  renderTimeslots = timeslots => {\r\n    return (\r\n      <ul>\r\n        {timeslots.map((timeslot, timeslotIndex) => {\r\n          return (\r\n            <li key={timeslotIndex} style={{ margin: \"1rem 0\" }}>\r\n              <TimeslotPreview timeslot={timeslot} />\r\n            </li>\r\n          );\r\n        })}\r\n      </ul>\r\n    );\r\n  };\r\n\r\n  renderDays = () => {\r\n    const { dates, timeslots } = this.state;\r\n    return (\r\n      <ul id=\"timeslotDayContainer\">\r\n        {dates.map((date, index) => {\r\n          const dayTimeslots = timeslots.filter(\r\n            timeslot =>\r\n              moment(date).format(\"D\") ===\r\n                moment(timeslot.start.dateTime).format(\"D\") &&\r\n              this.filterTimeslot(timeslot)\r\n          );\r\n          return (\r\n            dayTimeslots.length > 0 && (\r\n              <li key={index}>\r\n                <div className=\"row no-gutters\">\r\n                  <div className=\"col-2-10\" style={{ paddingTop: \"1.5rem\" }}>\r\n                    <div className=\"timeslotDay\">\r\n                      {moment(date).format(\"D\")}\r\n                    </div>\r\n                    <div className=\"timeslotDay\">\r\n                      {moment(date).format(\"MMM\")}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"col-8-10\">\r\n                    {this.renderTimeslots(dayTimeslots)}\r\n                  </div>\r\n                </div>\r\n              </li>\r\n            )\r\n          );\r\n        })}\r\n      </ul>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { language } = this.props;\r\n    const { filterDrawerVisible, filter } = this.state;\r\n    const texts = Texts[language].timeslotsList;\r\n    return (\r\n      <React.Fragment>\r\n        <FilterTimeslotsDrawer\r\n          isOpen={filterDrawerVisible}\r\n          handleFilterDrawerClick={this.handleFilterDrawerClick}\r\n          activeOption={filter}\r\n          handleFilterDrawerClose={this.handleFilterDrawerClose}\r\n        />\r\n        <div id=\"timeslotsListContainer\">\r\n          <div className=\"row no-gutters filterLabel\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"transparentButton\"\r\n              onClick={this.handleFilterDrawerVisibility}\r\n            >\r\n              {`${texts[filter]}  `}\r\n              <i className=\"fas fa-chevron-down\" />\r\n            </button>\r\n          </div>\r\n          {this.renderDays()}\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withLanguage(TimeslotsList);\r\n\r\nTimeslotsList.propTypes = {\r\n  dates: PropTypes.array,\r\n  timeslots: PropTypes.array,\r\n  language: PropTypes.string\r\n};\r\n"]},"metadata":{},"sourceType":"module"}