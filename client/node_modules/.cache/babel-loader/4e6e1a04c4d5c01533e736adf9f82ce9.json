{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\src\\\\components\\\\ManagePlanStepper.js\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { withStyles, MuiThemeProvider, createMuiTheme } from \"@material-ui/core/styles\";\nimport Stepper from \"@material-ui/core/Stepper\";\nimport MomentLocaleUtils from \"react-day-picker/moment\";\nimport Step from \"@material-ui/core/Step\";\nimport StepLabel from \"@material-ui/core/StepLabel\";\nimport StepContent from \"@material-ui/core/StepContent\";\nimport Button from \"@material-ui/core/Button\";\nimport { isMobile } from \"react-device-detect\";\nimport { withSnackbar } from \"notistack\";\nimport { withRouter } from \"react-router-dom\";\nimport { Select, MenuItem } from \"@material-ui/core\";\nimport axios from \"axios\";\nimport DayPicker from \"react-day-picker\";\nimport moment from \"moment\";\nimport LoadingSpinner from \"./LoadingSpinner\";\nimport Texts from \"../Constants/Texts\";\nimport withLanguage from \"./LanguageContext\";\nimport ManagePlanSolution from \"./ManagePlanSolution\";\nimport Log from \"./Log\";\nimport \"../styles/DayPicker.css\";\nimport TimeslotSubscribe from \"./TimeslotSubcribe\";\nvar modifiersStyles = {\n  selected: {\n    backgroundColor: \"#00838F\"\n  }\n};\nvar muiTheme = createMuiTheme({\n  typography: {\n    useNextVariants: true\n  },\n  overrides: {\n    MuiStepLabel: {\n      label: {\n        fontFamily: \"Roboto\",\n        fontSize: \"1.56rem\"\n      }\n    },\n    MuiStepIcon: {\n      root: {\n        display: \"block\",\n        width: \"3rem\",\n        height: \"3rem\",\n        \"&$active\": {\n          color: \"#00838f\"\n        },\n        \"&$completed\": {\n          color: \"#00838f\"\n        }\n      }\n    },\n    MuiButton: {\n      root: {\n        fontSize: \"1.4rem\",\n        fontFamily: \"Roboto\"\n      }\n    }\n  },\n  palette: {\n    secondary: {\n      main: \"#c43e00\"\n    }\n  }\n});\n\nvar styles = function styles(theme) {\n  return {\n    root: {\n      width: \"95%\"\n    },\n    continueButton: {\n      backgroundColor: \"#00838f\",\n      marginTop: theme.spacing.unit,\n      marginRight: theme.spacing.unit,\n      \"&:hover\": {\n        backgroundColor: \"#00838f\"\n      }\n    },\n    phaseButton: {\n      backgroundColor: \"#ff6f00\",\n      color: \"#ffffff\",\n      marginTop: theme.spacing.unit,\n      marginRight: theme.spacing.unit,\n      \"&:hover\": {\n        backgroundColor: \"#ff6f00\"\n      }\n    },\n    stepLabel: {\n      root: {\n        color: \"#ffffff\",\n        \"&$active\": {\n          color: \"white\",\n          fontWeight: 500\n        },\n        \"&$completed\": {\n          color: theme.palette.text.primary,\n          fontWeight: 500\n        },\n        \"&$alternativeLabel\": {\n          textAlign: \"center\",\n          marginTop: 16,\n          fontSize: \"5rem\"\n        },\n        \"&$error\": {\n          color: theme.palette.error.main\n        }\n      }\n    },\n    cancelButton: {\n      backgroundColor: \"#ffffff\",\n      marginTop: theme.spacing.unit,\n      color: \"grey\",\n      marginRight: theme.spacing.unit\n    },\n    actionsContainer: {\n      marginBottom: theme.spacing.unit * 2\n    },\n    resetContainer: {\n      padding: theme.spacing.unit * 3\n    }\n  };\n};\n\nvar ManagePlanStepper = /*#__PURE__*/function (_React$Component) {\n  _inherits(ManagePlanStepper, _React$Component);\n\n  var _super = _createSuper(ManagePlanStepper);\n\n  function ManagePlanStepper(props) {\n    var _this;\n\n    _classCallCheck(this, ManagePlanStepper);\n\n    _this = _super.call(this, props);\n\n    _this.handleMessage = function (event) {\n      var activeStep = _this.state.activeStep;\n      var history = _this.props.history;\n      var data = JSON.parse(event.data);\n\n      if (data.action === \"stepperGoBack\") {\n        if (activeStep - 1 >= 0) {\n          _this.setState({\n            activeStep: activeStep - 1\n          });\n        } else {\n          history.goBack();\n        }\n      }\n    };\n\n    _this.createSolution = function () {\n      var _this$props = _this.props,\n          history = _this$props.history,\n          enqueueSnackbar = _this$props.enqueueSnackbar,\n          match = _this$props.match,\n          language = _this$props.language;\n      var _match$params = match.params,\n          groupId = _match$params.groupId,\n          planId = _match$params.planId;\n      var texts = Texts[language].managePlanStepper;\n      var _this$state = _this.state,\n          editedSolution = _this$state.editedSolution,\n          parentsProfiles = _this$state.parentsProfiles,\n          plan = _this$state.plan,\n          timeslotsFilter = _this$state.timeslotsFilter,\n          activitiesCreation = _this$state.activitiesCreation,\n          amStartTime = _this$state.amStartTime,\n          amEndTime = _this$state.amEndTime,\n          pmStartTime = _this$state.pmStartTime,\n          pmEndTime = _this$state.pmEndTime;\n      plan.solution.forEach(function (s) {\n        var _s$slot$split = s.slot.split(\"-\"),\n            _s$slot$split2 = _slicedToArray(_s$slot$split, 2),\n            date = _s$slot$split2[0],\n            meridiem = _s$slot$split2[1];\n\n        s.start = new Date(date);\n        s.end = new Date(date);\n\n        if (meridiem === \"AM\") {\n          var amStart = amStartTime.split(\":\");\n          var amEnd = amEndTime.split(\":\");\n          s.start.setHours(amStart[0]);\n          s.start.setMinutes(amStart[1]);\n          s.end.setHours(amEnd[0]);\n          s.end.setMinutes(amEnd[1]);\n          s.startHour = amStart[0];\n          s.endHour = amEnd[0];\n        } else {\n          var pmStart = pmStartTime.split(\":\");\n          var pmEnd = pmEndTime.split(\":\");\n          s.start.setHours(pmStart[0]);\n          s.start.setMinutes(pmStart[1]);\n          s.end.setHours(pmEnd[0]);\n          s.end.setMinutes(pmEnd[1]);\n          s.startHour = pmStart[0];\n          s.endHour = pmEnd[0];\n        }\n\n        s.volunteers = [];\n      });\n      editedSolution.forEach(function (row) {\n        var keys = Object.keys(row);\n        keys.forEach(function (slot) {\n          var subscription = parentsProfiles.find(function (p) {\n            return \"\".concat(p.given_name, \" \").concat(p.family_name) === row[slot];\n          });\n\n          if (subscription) {\n            plan.solution.find(function (s) {\n              return s.slot === slot;\n            }).volunteers.push(subscription.user_id);\n          }\n        });\n      });\n\n      if (timeslotsFilter === \"discard\") {\n        plan.solution = plan.solution.filter(function (s) {\n          return s.volunteers.length > 0;\n        });\n      }\n\n      plan.activitiesCreation = activitiesCreation;\n\n      _this.setState({\n        updatingPlan: true\n      });\n\n      axios.post(\"/api/groups/\".concat(groupId, \"/plans/\").concat(planId, \"/activities\"), {\n        plan: plan\n      }).then(function (response) {\n        Log.info(response);\n        enqueueSnackbar(activitiesCreation === \"manually\" ? texts.manualSuccess : texts.automaticSuccess, {\n          variant: \"info\"\n        });\n        history.goBack();\n      }).catch(function (error) {\n        Log.error(error);\n      });\n    };\n\n    _this.sendLink = function () {\n      var _this$props2 = _this.props,\n          history = _this$props2.history,\n          enqueueSnackbar = _this$props2.enqueueSnackbar,\n          language = _this$props2.language;\n      var texts = Texts[language].managePlanStepper;\n      var userId = JSON.parse(localStorage.getItem(\"user\")).id;\n      axios.post(\"/api/users/\".concat(userId, \"/requestlink\"), {\n        link: history.location.pathname\n      }).then(function (response) {\n        Log.info(response);\n        enqueueSnackbar(texts.linkSuccess, {\n          variant: \"info\"\n        });\n        history.goBack();\n      }).catch(function (error) {\n        Log.error(error);\n      });\n    };\n\n    _this.updatePlan = function () {\n      var _this$props3 = _this.props,\n          history = _this$props3.history,\n          match = _this$props3.match,\n          enqueueSnackbar = _this$props3.enqueueSnackbar,\n          language = _this$props3.language;\n      var _match$params2 = match.params,\n          groupId = _match$params2.groupId,\n          planId = _match$params2.planId;\n      var texts = Texts[language].managePlanStepper;\n\n      _this.setState({\n        updatingPlan: true\n      });\n\n      var plan = _this.state.plan;\n      plan.participants.push(plan.participant);\n      delete plan.participant;\n      axios.patch(\"/api/groups/\".concat(groupId, \"/plans/\").concat(planId), {\n        plan: plan\n      }).then(function (response) {\n        Log.info(response);\n\n        if (plan.state === \"needs\" || plan.state === \"availabilities\") {\n          enqueueSnackbar(plan.state === \"needs\" ? texts.needsSuccess : texts.availabilitiesSuccess, {\n            variant: \"info\"\n          });\n          history.goBack();\n        }\n      }).catch(function (error) {\n        Log.error(error);\n      });\n    };\n\n    _this.validate = function () {\n      var valid = true;\n      var _this$props4 = _this.props,\n          enqueueSnackbar = _this$props4.enqueueSnackbar,\n          language = _this$props4.language;\n      var texts = Texts[language].managePlanStepper;\n      var _this$state2 = _this.state,\n          activeStep = _this$state2.activeStep,\n          _this$state2$plan$par = _this$state2.plan.participant,\n          availabilities = _this$state2$plan$par.availabilities,\n          needs = _this$state2$plan$par.needs;\n\n      if (activeStep === 1) {\n        needs.forEach(function (need) {\n          if (need.children.length === 0) {\n            enqueueSnackbar(\"\".concat(texts.needError, \" \").concat(moment(need.day).format(\"MMM DD\")), {\n              variant: \"error\"\n            });\n            valid = false;\n          }\n        });\n      } else if (activeStep === 3) {\n        availabilities.forEach(function (availability) {\n          if (availability.meridiem === \"\") {\n            enqueueSnackbar(\"\".concat(texts.availabilityError, \" \").concat(moment(availability.day).format(\"MMM DD\")), {\n              variant: \"error\"\n            });\n            valid = false;\n          }\n        });\n      }\n\n      return valid;\n    };\n\n    _this.handleContinue = function () {\n      var _this$state3 = _this.state,\n          activeStep = _this$state3.activeStep,\n          planStep = _this$state3.plan.step;\n\n      if (_this.validate()) {\n        if (activeStep === 3 && planStep === 2 || planStep === 0 && activeStep === 1) {\n          _this.updatePlan();\n        } else if (activeStep === 4 && isMobile) {\n          _this.sendLink();\n        } else if (activeStep === 5) {\n          _this.createSolution();\n        } else {\n          _this.setState(function (state) {\n            return {\n              activeStep: state.activeStep + 1\n            };\n          });\n        }\n      }\n    };\n\n    _this.handleCancel = function () {\n      _this.setState(function (state) {\n        return {\n          activeStep: state.activeStep - 1\n        };\n      });\n    };\n\n    _this.handleNeedDayClick = function (day, _ref) {\n      var selected = _ref.selected,\n          disabled = _ref.disabled;\n\n      if (disabled) {\n        return;\n      }\n\n      var plan = _this.state.plan;\n      var myChildren = _this.props.myChildren;\n\n      if (!selected) {\n        plan.participant.needs.push({\n          day: day,\n          children: myChildren.map(function (c) {\n            return c.child_id;\n          })\n        });\n      } else {\n        plan.participant.needs = plan.participant.needs.filter(function (n) {\n          return moment(n.day).format() !== moment(day).format();\n        });\n      }\n\n      _this.setState({\n        plan: plan\n      });\n    };\n\n    _this.handleAvailabilityDayClick = function (day, _ref2) {\n      var selected = _ref2.selected,\n          disabled = _ref2.disabled;\n\n      if (disabled) {\n        return;\n      }\n\n      var plan = _this.state.plan;\n\n      if (!selected) {\n        plan.participant.availabilities = [].concat(_toConsumableArray(plan.participant.availabilities), [{\n          day: day,\n          meridiem: \"both\"\n        }]).sort(function (a, b) {\n          return new Date(a.day) - new Date(b.day);\n        });\n      } else {\n        plan.participant.availabilities = plan.participant.availabilities.filter(function (n) {\n          return n.day.getTime() !== day.getTime();\n        });\n      }\n\n      _this.setState({\n        plan: plan\n      });\n    };\n\n    _this.handleSubscribe = function (day, childId) {\n      var _this$state4 = _this.state,\n          plan = _this$state4.plan,\n          needs = _this$state4.plan.participant.needs;\n      var needIndex = needs.findIndex(function (n) {\n        return n.day.getTime() === day.getTime();\n      });\n      plan.participant.needs[needIndex].children.push(childId);\n\n      _this.setState({\n        plan: plan\n      });\n    };\n\n    _this.handleUnsubscribe = function (day, childId) {\n      var _this$state5 = _this.state,\n          plan = _this$state5.plan,\n          needs = _this$state5.plan.participant.needs;\n      var needIndex = needs.findIndex(function (n) {\n        return n.day.getTime() === day.getTime();\n      });\n      var updatedNeeds = needs[needIndex].children.filter(function (c) {\n        return c !== childId;\n      });\n      plan.participant.needs[needIndex].children = updatedNeeds;\n\n      _this.setState({\n        plan: plan\n      });\n    };\n\n    _this.handleMeridiem = function (index, meridiem) {\n      var plan = _this.state.plan;\n      var currentMeridiem = plan.participant.availabilities[index].meridiem;\n      var updatedMeridiem;\n\n      if (currentMeridiem === \"both\") {\n        updatedMeridiem = meridiem === \"AM\" ? \"PM\" : \"AM\";\n      } else if (currentMeridiem === meridiem) {\n        updatedMeridiem = \"\";\n      } else {\n        updatedMeridiem = currentMeridiem === \"\" ? meridiem : \"both\";\n      }\n\n      plan.participant.availabilities[index].meridiem = updatedMeridiem;\n\n      _this.setState({\n        plan: plan\n      });\n    };\n\n    _this.getDisabledAvailabilityDates = function () {\n      var _this$state$plan = _this.state.plan,\n          participants = _this$state$plan.participants,\n          participant = _this$state$plan.participant,\n          from = _this$state$plan.from,\n          to = _this$state$plan.to;\n      var needDates = [];\n      [].concat(_toConsumableArray(participants), [participant]).forEach(function (p) {\n        p.needs.forEach(function (n) {\n          needDates.push(moment(n.day).format(\"DD-MMMM-YYYY\"));\n        });\n      });\n      needDates = _toConsumableArray(new Set(needDates));\n      var start = moment(from);\n      var end = moment(to);\n      var allDates = [start.format(\"DD-MMMM-YYYY\")];\n\n      while (start.add(1, \"days\").diff(end) <= 0) {\n        allDates.push(start.clone().format(\"DD-MMMM-YYYY\"));\n      }\n\n      allDates.push(end.format(\"DDMMYY\"));\n      var disabledDates = allDates.filter(function (d) {\n        return needDates.indexOf(d) === -1;\n      }).map(function (d) {\n        return moment(d).toDate();\n      });\n      return disabledDates;\n    };\n\n    _this.handleSolutionEditing = function (data) {\n      _this.setState({\n        editedSolution: data\n      });\n    };\n\n    _this.handleTimeslotsFilter = function (filter) {\n      _this.setState({\n        timeslotsFilter: filter\n      });\n    };\n\n    _this.handleActivitesCreation = function (option) {\n      _this.setState({\n        activitiesCreation: option\n      });\n    };\n\n    _this.handleTimeChange = function (event) {\n      var name = event.target.name;\n      var value = event.target.value;\n\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.getStepContent = function () {\n      var _this$props5 = _this.props,\n          language = _this$props5.language,\n          myChildren = _this$props5.myChildren;\n      var _this$state6 = _this.state,\n          activeStep = _this$state6.activeStep,\n          plan = _this$state6.plan,\n          parentsProfiles = _this$state6.parentsProfiles,\n          childrenProfiles = _this$state6.childrenProfiles,\n          activitiesCreation = _this$state6.activitiesCreation,\n          timeslotsFilter = _this$state6.timeslotsFilter,\n          amStartTime = _this$state6.amStartTime,\n          amEndTime = _this$state6.amEndTime,\n          pmStartTime = _this$state6.pmStartTime,\n          pmEndTime = _this$state6.pmEndTime;\n      var texts = Texts[language].managePlanStepper;\n\n      switch (activeStep) {\n        case 0:\n          return /*#__PURE__*/React.createElement(\"div\", {\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 539,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"deadlineHEader\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 540,\n              columnNumber: 13\n            }\n          }, \"\".concat(texts.needsDeadline, \" \").concat(moment(plan.deadline).format(\"MMM Do\"))), /*#__PURE__*/React.createElement(DayPicker, {\n            className: \"horizontalCenter\",\n            disabledDays: [{\n              before: new Date(plan.from),\n              after: new Date(plan.to)\n            }],\n            localeUtils: MomentLocaleUtils,\n            locale: language,\n            selectedDays: plan.participant.needs.map(function (n) {\n              return n.day;\n            }),\n            onDayClick: _this.handleNeedDayClick,\n            modifiersStyles: modifiersStyles,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 545,\n              columnNumber: 13\n            }\n          }));\n\n        case 1:\n          return /*#__PURE__*/React.createElement(\"ul\", {\n            className: \"needsList\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 563,\n              columnNumber: 11\n            }\n          }, plan.participant.needs.map(function (need) {\n            return /*#__PURE__*/React.createElement(\"li\", {\n              key: need.day.getTime(),\n              className: \"needContainer\",\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 565,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(\"div\", {\n              className: \"needHeader\",\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 566,\n                columnNumber: 17\n              }\n            }, moment(need.day).format(\"MMM Do\")), myChildren.map(function (child) {\n              return /*#__PURE__*/React.createElement(TimeslotSubscribe, {\n                key: child.child_id,\n                name: child.given_name,\n                image: child.image.path,\n                subscribed: need.children.includes(child.child_id),\n                id: child.child_id,\n                type: \"child\",\n                handleSubscribe: function handleSubscribe() {\n                  return _this.handleSubscribe(need.day, child.child_id);\n                },\n                handleUnsubscribe: function handleUnsubscribe() {\n                  return _this.handleUnsubscribe(need.day, child.child_id);\n                },\n                __self: _assertThisInitialized(_this),\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 570,\n                  columnNumber: 19\n                }\n              });\n            }));\n          }));\n\n        case 2:\n          return /*#__PURE__*/React.createElement(\"div\", {\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 591,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"deadlineHeader\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 592,\n              columnNumber: 13\n            }\n          }, \"\".concat(texts.availabilitiesDeadline, \" \").concat(moment(plan.deadline).format(\"MMM DD\"))), /*#__PURE__*/React.createElement(DayPicker, {\n            className: \"horizontalCenter\",\n            disabledDays: [].concat(_toConsumableArray(_this.getDisabledAvailabilityDates()), [{\n              before: new Date(plan.from),\n              after: new Date(plan.to)\n            }]),\n            localeUtils: MomentLocaleUtils,\n            locale: language,\n            selectedDays: plan.participant.availabilities.map(function (n) {\n              return n.day;\n            }),\n            onDayClick: _this.handleAvailabilityDayClick,\n            modifiersStyles: modifiersStyles,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 597,\n              columnNumber: 13\n            }\n          }));\n\n        case 3:\n          return /*#__PURE__*/React.createElement(\"ul\", {\n            className: \"availabilitiesList\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 616,\n              columnNumber: 11\n            }\n          }, plan.participant.availabilities.map(function (availability, index) {\n            return /*#__PURE__*/React.createElement(\"li\", {\n              key: availability.day.getTime(),\n              className: \"availabilityContainer\",\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 618,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(\"div\", {\n              className: \"availabilityHeader\",\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 622,\n                columnNumber: 17\n              }\n            }, moment(availability.day).format(\"MMM DD\")), /*#__PURE__*/React.createElement(\"div\", {\n              role: \"button\",\n              tabIndex: -42,\n              style: availability.meridiem === \"both\" || availability.meridiem === \"AM\" ? {\n                backgroundColor: \"#00838F\",\n                color: \"#FFFFFF\"\n              } : {},\n              onClick: function onClick() {\n                return _this.handleMeridiem(index, \"AM\");\n              },\n              className: \"meridiemBox\",\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 625,\n                columnNumber: 17\n              }\n            }, \"AM\"), /*#__PURE__*/React.createElement(\"div\", {\n              role: \"button\",\n              tabIndex: -42,\n              style: availability.meridiem === \"both\" || availability.meridiem === \"PM\" ? {\n                backgroundColor: \"#00838F\",\n                color: \"#FFFFFF\"\n              } : {},\n              onClick: function onClick() {\n                return _this.handleMeridiem(index, \"PM\");\n              },\n              className: \"meridiemBox\",\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 639,\n                columnNumber: 17\n              }\n            }, \"PM\"));\n          }));\n\n        case 4:\n          return isMobile ? /*#__PURE__*/React.createElement(\"div\", {\n            className: \"row no-gutters\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 659,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(\"p\", {\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 660,\n              columnNumber: 13\n            }\n          }, texts.desktopPrompt)) : /*#__PURE__*/React.createElement(ManagePlanSolution, {\n            plan: plan,\n            parentsProfiles: parentsProfiles,\n            childrenProfiles: childrenProfiles,\n            handleEdits: _this.handleSolutionEditing,\n            handleFilter: _this.handleTimeslotsFilter,\n            handleCreation: _this.handleActivitesCreation,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 663,\n              columnNumber: 11\n            }\n          });\n\n        case 5:\n          return /*#__PURE__*/React.createElement(\"div\", {\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 674,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"row no-gutters\",\n            style: {\n              marginTop: \"2rem\"\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 675,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 676,\n              columnNumber: 15\n            }\n          }, texts.zeroVolunteersTimeslots), /*#__PURE__*/React.createElement(\"div\", {\n            style: {\n              width: \"100\"\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 679,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(Select, {\n            value: timeslotsFilter,\n            onChange: function onChange(event) {\n              _this.setState({\n                timeslotsFilter: event.target.value\n              });\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 680,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(MenuItem, {\n            value: \"create\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 686,\n              columnNumber: 19\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 687,\n              columnNumber: 21\n            }\n          }, texts.create)), /*#__PURE__*/React.createElement(MenuItem, {\n            value: \"discard\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 689,\n              columnNumber: 19\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 690,\n              columnNumber: 21\n            }\n          }, texts.discard))))), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"row no-gutters\",\n            style: {\n              marginTop: \"2rem\"\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 695,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 696,\n              columnNumber: 15\n            }\n          }, texts.activitiesCreation), /*#__PURE__*/React.createElement(\"div\", {\n            style: {\n              width: \"100\"\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 697,\n              columnNumber: 15\n            }\n          }, /*#__PURE__*/React.createElement(Select, {\n            value: activitiesCreation,\n            onChange: function onChange(event) {\n              _this.setState({\n                activitiesCreation: event.target.value\n              });\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 698,\n              columnNumber: 17\n            }\n          }, /*#__PURE__*/React.createElement(MenuItem, {\n            value: \"automatically\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 704,\n              columnNumber: 19\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 705,\n              columnNumber: 21\n            }\n          }, texts.automatically)), /*#__PURE__*/React.createElement(MenuItem, {\n            value: \"manually\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 707,\n              columnNumber: 19\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 708,\n              columnNumber: 21\n            }\n          }, texts.manually))))), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"row no-gutters\",\n            style: {\n              marginTop: \"2rem\",\n              alignItems: \"center\"\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 713,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 717,\n              columnNumber: 15\n            }\n          }, texts.amTimeslotFrom), /*#__PURE__*/React.createElement(\"input\", {\n            name: \"amStartTime\",\n            type: \"time\",\n            value: amStartTime,\n            onChange: _this.handleTimeChange,\n            className: \"expandedTimeslotTimeInput form-control\",\n            required: true,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 718,\n              columnNumber: 15\n            }\n          }), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 726,\n              columnNumber: 15\n            }\n          }, texts.amTimeslotTo), /*#__PURE__*/React.createElement(\"input\", {\n            name: \"amEndTime\",\n            type: \"time\",\n            value: amEndTime,\n            onChange: _this.handleTimeChange,\n            className: \"expandedTimeslotTimeInput form-control\",\n            required: true,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 727,\n              columnNumber: 15\n            }\n          })), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"row no-gutters\",\n            style: {\n              marginTop: \"2rem\",\n              alignItems: \"center\"\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 736,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 740,\n              columnNumber: 15\n            }\n          }, texts.pmTimeslotFrom), /*#__PURE__*/React.createElement(\"input\", {\n            name: \"pmStartTime\",\n            type: \"time\",\n            value: pmStartTime,\n            onChange: _this.handleTimeChange,\n            className: \"expandedTimeslotTimeInput form-control\",\n            required: true,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 741,\n              columnNumber: 15\n            }\n          }), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"categoryText\",\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 749,\n              columnNumber: 15\n            }\n          }, texts.pmTimeslotTo), /*#__PURE__*/React.createElement(\"input\", {\n            name: \"pmEndTime\",\n            type: \"time\",\n            value: pmEndTime,\n            onChange: _this.handleTimeChange,\n            className: \"expandedTimeslotTimeInput form-control\",\n            required: true,\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 750,\n              columnNumber: 15\n            }\n          })));\n\n        default:\n          return /*#__PURE__*/React.createElement(\"div\", {\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 762,\n              columnNumber: 16\n            }\n          }, \"Lorem Ipsum\");\n      }\n    };\n\n    _this.getContinueText = function (activeStep, planStep) {\n      var language = _this.props.language;\n      var texts = Texts[language].managePlanStepper;\n\n      if (activeStep === 1 && planStep === 0 || activeStep === 3 && planStep === 2) {\n        return texts.finish;\n      }\n\n      if (planStep === 4) {\n        if (activeStep === 4 && isMobile) {\n          return texts.link;\n        }\n\n        if (activeStep === 5) {\n          return texts.activitiesCreation;\n        }\n      }\n\n      return texts.continue;\n    };\n\n    var _userId = JSON.parse(localStorage.getItem(\"user\")).id;\n    var _plan = props.plan,\n        _parentsProfiles = props.parentsProfiles,\n        _childrenProfiles = props.childrenProfiles;\n    _plan.participant = _plan.participants.find(function (p) {\n      return p.user_id === _userId;\n    }) || {\n      user_id: _userId,\n      needs: [],\n      availabilities: []\n    };\n\n    _plan.participant.needs.forEach(function (need) {\n      need.day = new Date(need.day);\n    });\n\n    _plan.participant.availabilities.forEach(function (availability) {\n      availability.day = new Date(availability.day);\n    });\n\n    var _activeStep;\n\n    _plan.participants = _plan.participants.filter(function (p) {\n      return p.user_id !== _userId;\n    });\n\n    switch (_plan.state) {\n      case \"needs\":\n        _activeStep = 0;\n        _plan.step = 0;\n        break;\n\n      case \"availabilities\":\n        _activeStep = 2;\n        _plan.step = 2;\n        break;\n\n      case \"planning\":\n        _activeStep = 4;\n        _plan.step = 4;\n        break;\n\n      default:\n    }\n\n    _this.state = {\n      plan: _plan,\n      updatingPlan: false,\n      activeStep: _activeStep,\n      activitiesCreation: \"automatically\",\n      timeslotsFilter: \"create\",\n      parentsProfiles: _parentsProfiles || [],\n      childrenProfiles: _childrenProfiles || [],\n      amStartTime: \"09:00\",\n      amEndTime: \"12:00\",\n      pmStartTime: \"15:00\",\n      pmEndTime: \"18:00\"\n    };\n    return _this;\n  }\n\n  _createClass(ManagePlanStepper, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener(\"message\", this.handleMessage, false);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(\"message\", this.handleMessage, false);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props6 = this.props,\n          classes = _this$props6.classes,\n          language = _this$props6.language,\n          userIsAdmin = _this$props6.userIsAdmin;\n      var texts = Texts[language].managePlanStepper;\n      var steps = texts.stepLabels;\n      var _this$state7 = this.state,\n          activeStep = _this$state7.activeStep,\n          updatingPlan = _this$state7.updatingPlan,\n          planStep = _this$state7.plan.step;\n      return !updatingPlan ? /*#__PURE__*/React.createElement(\"div\", {\n        className: classes.root,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 797,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(MuiThemeProvider, {\n        theme: muiTheme,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 798,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Stepper, {\n        activeStep: activeStep,\n        orientation: \"vertical\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 799,\n          columnNumber: 11\n        }\n      }, steps.map(function (label, index) {\n        return (index < 4 || userIsAdmin) && /*#__PURE__*/React.createElement(Step, {\n          key: label,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 803,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(StepLabel, {\n          className: classes.stepLabel,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 804,\n            columnNumber: 21\n          }\n        }, label), /*#__PURE__*/React.createElement(StepContent, {\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 805,\n            columnNumber: 21\n          }\n        }, _this2.getStepContent(), /*#__PURE__*/React.createElement(\"div\", {\n          className: classes.actionsContainer,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 807,\n            columnNumber: 23\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 808,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: _this2.handleContinue,\n          className: classes.continueButton,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 809,\n            columnNumber: 27\n          }\n        }, _this2.getContinueText(activeStep, planStep)), /*#__PURE__*/React.createElement(Button, {\n          disabled: activeStep === 0 || activeStep <= planStep,\n          onClick: _this2.handleCancel,\n          className: classes.cancelButton,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 817,\n            columnNumber: 27\n          }\n        }, texts.cancel)))));\n      })))) : /*#__PURE__*/React.createElement(LoadingSpinner, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return ManagePlanStepper;\n}(React.Component);\n\nManagePlanStepper.propTypes = {\n  classes: PropTypes.object,\n  history: PropTypes.object,\n  language: PropTypes.string,\n  match: PropTypes.object,\n  plan: PropTypes.object,\n  myChildren: PropTypes.array,\n  enqueueSnackbar: PropTypes.func,\n  parentsProfiles: PropTypes.array,\n  childrenProfiles: PropTypes.array,\n  userIsAdmin: PropTypes.bool\n};\nexport default withSnackbar(withRouter(withLanguage(withStyles(styles)(ManagePlanStepper))));","map":{"version":3,"sources":["C:/Users/nucle/Documents/GitHub/Families_Share-platform/client/src/components/ManagePlanStepper.js"],"names":["React","PropTypes","withStyles","MuiThemeProvider","createMuiTheme","Stepper","MomentLocaleUtils","Step","StepLabel","StepContent","Button","isMobile","withSnackbar","withRouter","Select","MenuItem","axios","DayPicker","moment","LoadingSpinner","Texts","withLanguage","ManagePlanSolution","Log","TimeslotSubscribe","modifiersStyles","selected","backgroundColor","muiTheme","typography","useNextVariants","overrides","MuiStepLabel","label","fontFamily","fontSize","MuiStepIcon","root","display","width","height","color","MuiButton","palette","secondary","main","styles","theme","continueButton","marginTop","spacing","unit","marginRight","phaseButton","stepLabel","fontWeight","text","primary","textAlign","error","cancelButton","actionsContainer","marginBottom","resetContainer","padding","ManagePlanStepper","props","handleMessage","event","activeStep","state","history","data","JSON","parse","action","setState","goBack","createSolution","enqueueSnackbar","match","language","params","groupId","planId","texts","managePlanStepper","editedSolution","parentsProfiles","plan","timeslotsFilter","activitiesCreation","amStartTime","amEndTime","pmStartTime","pmEndTime","solution","forEach","s","slot","split","date","meridiem","start","Date","end","amStart","amEnd","setHours","setMinutes","startHour","endHour","pmStart","pmEnd","volunteers","row","keys","Object","subscription","find","p","given_name","family_name","push","user_id","filter","length","updatingPlan","post","then","response","info","manualSuccess","automaticSuccess","variant","catch","sendLink","userId","localStorage","getItem","id","link","location","pathname","linkSuccess","updatePlan","participants","participant","patch","needsSuccess","availabilitiesSuccess","validate","valid","availabilities","needs","need","children","needError","day","format","availability","availabilityError","handleContinue","planStep","step","handleCancel","handleNeedDayClick","disabled","myChildren","map","c","child_id","n","handleAvailabilityDayClick","sort","a","b","getTime","handleSubscribe","childId","needIndex","findIndex","handleUnsubscribe","updatedNeeds","handleMeridiem","index","currentMeridiem","updatedMeridiem","getDisabledAvailabilityDates","from","to","needDates","Set","allDates","add","diff","clone","disabledDates","d","indexOf","toDate","handleSolutionEditing","handleTimeslotsFilter","handleActivitesCreation","option","handleTimeChange","name","target","value","getStepContent","childrenProfiles","needsDeadline","deadline","before","after","child","image","path","includes","availabilitiesDeadline","desktopPrompt","zeroVolunteersTimeslots","create","discard","automatically","manually","alignItems","amTimeslotFrom","amTimeslotTo","pmTimeslotFrom","pmTimeslotTo","getContinueText","finish","continue","document","addEventListener","removeEventListener","classes","userIsAdmin","steps","stepLabels","cancel","Component","propTypes","object","string","array","func","bool"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport {\r\n  withStyles,\r\n  MuiThemeProvider,\r\n  createMuiTheme\r\n} from \"@material-ui/core/styles\";\r\nimport Stepper from \"@material-ui/core/Stepper\";\r\nimport MomentLocaleUtils from \"react-day-picker/moment\";\r\nimport Step from \"@material-ui/core/Step\";\r\nimport StepLabel from \"@material-ui/core/StepLabel\";\r\nimport StepContent from \"@material-ui/core/StepContent\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { isMobile } from \"react-device-detect\";\r\nimport { withSnackbar } from \"notistack\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport { Select, MenuItem } from \"@material-ui/core\";\r\nimport axios from \"axios\";\r\nimport DayPicker from \"react-day-picker\";\r\nimport moment from \"moment\";\r\nimport LoadingSpinner from \"./LoadingSpinner\";\r\nimport Texts from \"../Constants/Texts\";\r\nimport withLanguage from \"./LanguageContext\";\r\nimport ManagePlanSolution from \"./ManagePlanSolution\";\r\nimport Log from \"./Log\";\r\nimport \"../styles/DayPicker.css\";\r\nimport TimeslotSubscribe from \"./TimeslotSubcribe\";\r\n\r\nconst modifiersStyles = {\r\n  selected: {\r\n    backgroundColor: \"#00838F\"\r\n  }\r\n};\r\n\r\nconst muiTheme = createMuiTheme({\r\n  typography: {\r\n    useNextVariants: true\r\n  },\r\n  overrides: {\r\n    MuiStepLabel: {\r\n      label: {\r\n        fontFamily: \"Roboto\",\r\n        fontSize: \"1.56rem\"\r\n      }\r\n    },\r\n    MuiStepIcon: {\r\n      root: {\r\n        display: \"block\",\r\n        width: \"3rem\",\r\n        height: \"3rem\",\r\n        \"&$active\": {\r\n          color: \"#00838f\"\r\n        },\r\n        \"&$completed\": {\r\n          color: \"#00838f\"\r\n        }\r\n      }\r\n    },\r\n    MuiButton: {\r\n      root: {\r\n        fontSize: \"1.4rem\",\r\n        fontFamily: \"Roboto\"\r\n      }\r\n    }\r\n  },\r\n  palette: {\r\n    secondary: {\r\n      main: \"#c43e00\"\r\n    }\r\n  }\r\n});\r\n\r\nconst styles = theme => ({\r\n  root: {\r\n    width: \"95%\"\r\n  },\r\n  continueButton: {\r\n    backgroundColor: \"#00838f\",\r\n    marginTop: theme.spacing.unit,\r\n    marginRight: theme.spacing.unit,\r\n    \"&:hover\": {\r\n      backgroundColor: \"#00838f\"\r\n    }\r\n  },\r\n  phaseButton: {\r\n    backgroundColor: \"#ff6f00\",\r\n    color: \"#ffffff\",\r\n    marginTop: theme.spacing.unit,\r\n    marginRight: theme.spacing.unit,\r\n    \"&:hover\": {\r\n      backgroundColor: \"#ff6f00\"\r\n    }\r\n  },\r\n  stepLabel: {\r\n    root: {\r\n      color: \"#ffffff\",\r\n      \"&$active\": {\r\n        color: \"white\",\r\n        fontWeight: 500\r\n      },\r\n      \"&$completed\": {\r\n        color: theme.palette.text.primary,\r\n        fontWeight: 500\r\n      },\r\n      \"&$alternativeLabel\": {\r\n        textAlign: \"center\",\r\n        marginTop: 16,\r\n        fontSize: \"5rem\"\r\n      },\r\n      \"&$error\": {\r\n        color: theme.palette.error.main\r\n      }\r\n    }\r\n  },\r\n  cancelButton: {\r\n    backgroundColor: \"#ffffff\",\r\n    marginTop: theme.spacing.unit,\r\n    color: \"grey\",\r\n    marginRight: theme.spacing.unit\r\n  },\r\n  actionsContainer: {\r\n    marginBottom: theme.spacing.unit * 2\r\n  },\r\n  resetContainer: {\r\n    padding: theme.spacing.unit * 3\r\n  }\r\n});\r\n\r\nclass ManagePlanStepper extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n    const { plan, parentsProfiles, childrenProfiles } = props;\r\n    plan.participant = plan.participants.find(p => p.user_id === userId) || {\r\n      user_id: userId,\r\n      needs: [],\r\n      availabilities: []\r\n    };\r\n    plan.participant.needs.forEach(need => {\r\n      need.day = new Date(need.day);\r\n    });\r\n    plan.participant.availabilities.forEach(availability => {\r\n      availability.day = new Date(availability.day);\r\n    });\r\n    let activeStep;\r\n    plan.participants = plan.participants.filter(p => p.user_id !== userId);\r\n    switch (plan.state) {\r\n      case \"needs\":\r\n        activeStep = 0;\r\n        plan.step = 0;\r\n        break;\r\n      case \"availabilities\":\r\n        activeStep = 2;\r\n        plan.step = 2;\r\n        break;\r\n      case \"planning\":\r\n        activeStep = 4;\r\n        plan.step = 4;\r\n        break;\r\n      default:\r\n    }\r\n    this.state = {\r\n      plan,\r\n      updatingPlan: false,\r\n      activeStep,\r\n      activitiesCreation: \"automatically\",\r\n      timeslotsFilter: \"create\",\r\n      parentsProfiles: parentsProfiles || [],\r\n      childrenProfiles: childrenProfiles || [],\r\n      amStartTime: \"09:00\",\r\n      amEndTime: \"12:00\",\r\n      pmStartTime: \"15:00\",\r\n      pmEndTime: \"18:00\"\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"message\", this.handleMessage, false);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"message\", this.handleMessage, false);\r\n  }\r\n\r\n  handleMessage = event => {\r\n    const { activeStep } = this.state;\r\n    const { history } = this.props;\r\n    const data = JSON.parse(event.data);\r\n    if (data.action === \"stepperGoBack\") {\r\n      if (activeStep - 1 >= 0) {\r\n        this.setState({ activeStep: activeStep - 1 });\r\n      } else {\r\n        history.goBack();\r\n      }\r\n    }\r\n  };\r\n\r\n  createSolution = () => {\r\n    const { history, enqueueSnackbar, match, language } = this.props;\r\n    const { groupId, planId } = match.params;\r\n    const texts = Texts[language].managePlanStepper;\r\n    const {\r\n      editedSolution,\r\n      parentsProfiles,\r\n      plan,\r\n      timeslotsFilter,\r\n      activitiesCreation,\r\n      amStartTime,\r\n      amEndTime,\r\n      pmStartTime,\r\n      pmEndTime\r\n    } = this.state;\r\n    plan.solution.forEach(s => {\r\n      const [date, meridiem] = s.slot.split(\"-\");\r\n      s.start = new Date(date);\r\n      s.end = new Date(date);\r\n      if (meridiem === \"AM\") {\r\n        const amStart = amStartTime.split(\":\");\r\n        const amEnd = amEndTime.split(\":\");\r\n        s.start.setHours(amStart[0]);\r\n        s.start.setMinutes(amStart[1]);\r\n        s.end.setHours(amEnd[0]);\r\n        s.end.setMinutes(amEnd[1]);\r\n        s.startHour = amStart[0];\r\n        s.endHour = amEnd[0];\r\n      } else {\r\n        const pmStart = pmStartTime.split(\":\");\r\n        const pmEnd = pmEndTime.split(\":\");\r\n        s.start.setHours(pmStart[0]);\r\n        s.start.setMinutes(pmStart[1]);\r\n        s.end.setHours(pmEnd[0]);\r\n        s.end.setMinutes(pmEnd[1]);\r\n        s.startHour = pmStart[0];\r\n        s.endHour = pmEnd[0];\r\n      }\r\n      s.volunteers = [];\r\n    });\r\n    editedSolution.forEach(row => {\r\n      const keys = Object.keys(row);\r\n      keys.forEach(slot => {\r\n        const subscription = parentsProfiles.find(\r\n          p => `${p.given_name} ${p.family_name}` === row[slot]\r\n        );\r\n        if (subscription) {\r\n          plan.solution\r\n            .find(s => s.slot === slot)\r\n            .volunteers.push(subscription.user_id);\r\n        }\r\n      });\r\n    });\r\n    if (timeslotsFilter === \"discard\") {\r\n      plan.solution = plan.solution.filter(s => s.volunteers.length > 0);\r\n    }\r\n    plan.activitiesCreation = activitiesCreation;\r\n    this.setState({ updatingPlan: true });\r\n    axios\r\n      .post(`/api/groups/${groupId}/plans/${planId}/activities`, {\r\n        plan\r\n      })\r\n      .then(response => {\r\n        Log.info(response);\r\n\r\n        enqueueSnackbar(\r\n          activitiesCreation === \"manually\"\r\n            ? texts.manualSuccess\r\n            : texts.automaticSuccess,\r\n          {\r\n            variant: \"info\"\r\n          }\r\n        );\r\n        history.goBack();\r\n      })\r\n      .catch(error => {\r\n        Log.error(error);\r\n      });\r\n  };\r\n\r\n  sendLink = () => {\r\n    const { history, enqueueSnackbar, language } = this.props;\r\n    const texts = Texts[language].managePlanStepper;\r\n    const userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n    axios\r\n      .post(`/api/users/${userId}/requestlink`, {\r\n        link: history.location.pathname\r\n      })\r\n      .then(response => {\r\n        Log.info(response);\r\n        enqueueSnackbar(texts.linkSuccess, {\r\n          variant: \"info\"\r\n        });\r\n        history.goBack();\r\n      })\r\n      .catch(error => {\r\n        Log.error(error);\r\n      });\r\n  };\r\n\r\n  updatePlan = () => {\r\n    const { history, match, enqueueSnackbar, language } = this.props;\r\n    const { groupId, planId } = match.params;\r\n    const texts = Texts[language].managePlanStepper;\r\n    this.setState({ updatingPlan: true });\r\n    const { plan } = this.state;\r\n    plan.participants.push(plan.participant);\r\n    delete plan.participant;\r\n    axios\r\n      .patch(`/api/groups/${groupId}/plans/${planId}`, {\r\n        plan\r\n      })\r\n      .then(response => {\r\n        Log.info(response);\r\n        if (plan.state === \"needs\" || plan.state === \"availabilities\") {\r\n          enqueueSnackbar(\r\n            plan.state === \"needs\"\r\n              ? texts.needsSuccess\r\n              : texts.availabilitiesSuccess,\r\n            {\r\n              variant: \"info\"\r\n            }\r\n          );\r\n          history.goBack();\r\n        }\r\n      })\r\n      .catch(error => {\r\n        Log.error(error);\r\n      });\r\n  };\r\n\r\n  validate = () => {\r\n    let valid = true;\r\n    const { enqueueSnackbar, language } = this.props;\r\n    const texts = Texts[language].managePlanStepper;\r\n    const {\r\n      activeStep,\r\n      plan: {\r\n        participant: { availabilities, needs }\r\n      }\r\n    } = this.state;\r\n    if (activeStep === 1) {\r\n      needs.forEach(need => {\r\n        if (need.children.length === 0) {\r\n          enqueueSnackbar(\r\n            `${texts.needError} ${moment(need.day).format(\"MMM DD\")}`,\r\n            {\r\n              variant: \"error\"\r\n            }\r\n          );\r\n          valid = false;\r\n        }\r\n      });\r\n    } else if (activeStep === 3) {\r\n      availabilities.forEach(availability => {\r\n        if (availability.meridiem === \"\") {\r\n          enqueueSnackbar(\r\n            `${texts.availabilityError} ${moment(availability.day).format(\r\n              \"MMM DD\"\r\n            )}`,\r\n            {\r\n              variant: \"error\"\r\n            }\r\n          );\r\n          valid = false;\r\n        }\r\n      });\r\n    }\r\n    return valid;\r\n  };\r\n\r\n  handleContinue = () => {\r\n    const {\r\n      activeStep,\r\n      plan: { step: planStep }\r\n    } = this.state;\r\n    if (this.validate()) {\r\n      if (\r\n        (activeStep === 3 && planStep === 2) ||\r\n        (planStep === 0 && activeStep === 1)\r\n      ) {\r\n        this.updatePlan();\r\n      } else if (activeStep === 4 && isMobile) {\r\n        this.sendLink();\r\n      } else if (activeStep === 5) {\r\n        this.createSolution();\r\n      } else {\r\n        this.setState(state => ({\r\n          activeStep: state.activeStep + 1\r\n        }));\r\n      }\r\n    }\r\n  };\r\n\r\n  handleCancel = () => {\r\n    this.setState(state => ({\r\n      activeStep: state.activeStep - 1\r\n    }));\r\n  };\r\n\r\n  handleNeedDayClick = (day, { selected, disabled }) => {\r\n    if (disabled) {\r\n      return;\r\n    }\r\n    const { plan } = this.state;\r\n    const { myChildren } = this.props;\r\n    if (!selected) {\r\n      plan.participant.needs.push({\r\n        day,\r\n        children: myChildren.map(c => c.child_id)\r\n      });\r\n    } else {\r\n      plan.participant.needs = plan.participant.needs.filter(\r\n        n => moment(n.day).format() !== moment(day).format()\r\n      );\r\n    }\r\n    this.setState({ plan });\r\n  };\r\n\r\n  handleAvailabilityDayClick = (day, { selected, disabled }) => {\r\n    if (disabled) {\r\n      return;\r\n    }\r\n    const { plan } = this.state;\r\n    if (!selected) {\r\n      plan.participant.availabilities = [\r\n        ...plan.participant.availabilities,\r\n        {\r\n          day,\r\n          meridiem: \"both\"\r\n        }\r\n      ].sort((a, b) => new Date(a.day) - new Date(b.day));\r\n    } else {\r\n      plan.participant.availabilities = plan.participant.availabilities.filter(\r\n        n => n.day.getTime() !== day.getTime()\r\n      );\r\n    }\r\n    this.setState({ plan });\r\n  };\r\n\r\n  handleSubscribe = (day, childId) => {\r\n    const {\r\n      plan,\r\n      plan: {\r\n        participant: { needs }\r\n      }\r\n    } = this.state;\r\n    const needIndex = needs.findIndex(n => n.day.getTime() === day.getTime());\r\n    plan.participant.needs[needIndex].children.push(childId);\r\n    this.setState({ plan });\r\n  };\r\n\r\n  handleUnsubscribe = (day, childId) => {\r\n    const {\r\n      plan,\r\n      plan: {\r\n        participant: { needs }\r\n      }\r\n    } = this.state;\r\n    const needIndex = needs.findIndex(n => n.day.getTime() === day.getTime());\r\n\r\n    const updatedNeeds = needs[needIndex].children.filter(c => c !== childId);\r\n    plan.participant.needs[needIndex].children = updatedNeeds;\r\n    this.setState({ plan });\r\n  };\r\n\r\n  handleMeridiem = (index, meridiem) => {\r\n    const { plan } = this.state;\r\n    const currentMeridiem = plan.participant.availabilities[index].meridiem;\r\n    let updatedMeridiem;\r\n    if (currentMeridiem === \"both\") {\r\n      updatedMeridiem = meridiem === \"AM\" ? \"PM\" : \"AM\";\r\n    } else if (currentMeridiem === meridiem) {\r\n      updatedMeridiem = \"\";\r\n    } else {\r\n      updatedMeridiem = currentMeridiem === \"\" ? meridiem : \"both\";\r\n    }\r\n    plan.participant.availabilities[index].meridiem = updatedMeridiem;\r\n    this.setState({ plan });\r\n  };\r\n\r\n  getDisabledAvailabilityDates = () => {\r\n    const {\r\n      plan: { participants, participant, from, to }\r\n    } = this.state;\r\n    let needDates = [];\r\n    [...participants, participant].forEach(p => {\r\n      p.needs.forEach(n => {\r\n        needDates.push(moment(n.day).format(\"DD-MMMM-YYYY\"));\r\n      });\r\n    });\r\n    needDates = [...new Set(needDates)];\r\n    const start = moment(from);\r\n    const end = moment(to);\r\n    const allDates = [start.format(\"DD-MMMM-YYYY\")];\r\n    while (start.add(1, \"days\").diff(end) <= 0) {\r\n      allDates.push(start.clone().format(\"DD-MMMM-YYYY\"));\r\n    }\r\n    allDates.push(end.format(\"DDMMYY\"));\r\n    const disabledDates = allDates\r\n      .filter(d => needDates.indexOf(d) === -1)\r\n      .map(d => moment(d).toDate());\r\n    return disabledDates;\r\n  };\r\n\r\n  handleSolutionEditing = data => {\r\n    this.setState({ editedSolution: data });\r\n  };\r\n\r\n  handleTimeslotsFilter = filter => {\r\n    this.setState({ timeslotsFilter: filter });\r\n  };\r\n\r\n  handleActivitesCreation = option => {\r\n    this.setState({ activitiesCreation: option });\r\n  };\r\n\r\n  handleTimeChange = event => {\r\n    const { name } = event.target;\r\n    const { value } = event.target;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  getStepContent = () => {\r\n    const { language, myChildren } = this.props;\r\n    const {\r\n      activeStep,\r\n      plan,\r\n      parentsProfiles,\r\n      childrenProfiles,\r\n      activitiesCreation,\r\n      timeslotsFilter,\r\n      amStartTime,\r\n      amEndTime,\r\n      pmStartTime,\r\n      pmEndTime\r\n    } = this.state;\r\n    const texts = Texts[language].managePlanStepper;\r\n    switch (activeStep) {\r\n      case 0:\r\n        return (\r\n          <div>\r\n            <div className=\"deadlineHEader\">\r\n              {`${texts.needsDeadline} ${moment(plan.deadline).format(\r\n                \"MMM Do\"\r\n              )}`}\r\n            </div>\r\n            <DayPicker\r\n              className=\"horizontalCenter\"\r\n              disabledDays={[\r\n                {\r\n                  before: new Date(plan.from),\r\n                  after: new Date(plan.to)\r\n                }\r\n              ]}\r\n              localeUtils={MomentLocaleUtils}\r\n              locale={language}\r\n              selectedDays={plan.participant.needs.map(n => n.day)}\r\n              onDayClick={this.handleNeedDayClick}\r\n              modifiersStyles={modifiersStyles}\r\n            />\r\n          </div>\r\n        );\r\n      case 1:\r\n        return (\r\n          <ul className=\"needsList\">\r\n            {plan.participant.needs.map(need => (\r\n              <li key={need.day.getTime()} className=\"needContainer\">\r\n                <div className=\"needHeader\">\r\n                  {moment(need.day).format(\"MMM Do\")}\r\n                </div>\r\n                {myChildren.map(child => (\r\n                  <TimeslotSubscribe\r\n                    key={child.child_id}\r\n                    name={child.given_name}\r\n                    image={child.image.path}\r\n                    subscribed={need.children.includes(child.child_id)}\r\n                    id={child.child_id}\r\n                    type=\"child\"\r\n                    handleSubscribe={() =>\r\n                      this.handleSubscribe(need.day, child.child_id)\r\n                    }\r\n                    handleUnsubscribe={() =>\r\n                      this.handleUnsubscribe(need.day, child.child_id)\r\n                    }\r\n                  />\r\n                ))}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        );\r\n      case 2:\r\n        return (\r\n          <div>\r\n            <div className=\"deadlineHeader\">\r\n              {`${texts.availabilitiesDeadline} ${moment(plan.deadline).format(\r\n                \"MMM DD\"\r\n              )}`}\r\n            </div>\r\n            <DayPicker\r\n              className=\"horizontalCenter\"\r\n              disabledDays={[\r\n                ...this.getDisabledAvailabilityDates(),\r\n                {\r\n                  before: new Date(plan.from),\r\n                  after: new Date(plan.to)\r\n                }\r\n              ]}\r\n              localeUtils={MomentLocaleUtils}\r\n              locale={language}\r\n              selectedDays={plan.participant.availabilities.map(n => n.day)}\r\n              onDayClick={this.handleAvailabilityDayClick}\r\n              modifiersStyles={modifiersStyles}\r\n            />\r\n          </div>\r\n        );\r\n      case 3:\r\n        return (\r\n          <ul className=\"availabilitiesList\">\r\n            {plan.participant.availabilities.map((availability, index) => (\r\n              <li\r\n                key={availability.day.getTime()}\r\n                className=\"availabilityContainer\"\r\n              >\r\n                <div className=\"availabilityHeader\">\r\n                  {moment(availability.day).format(\"MMM DD\")}\r\n                </div>\r\n                <div\r\n                  role=\"button\"\r\n                  tabIndex={-42}\r\n                  style={\r\n                    availability.meridiem === \"both\" ||\r\n                    availability.meridiem === \"AM\"\r\n                      ? { backgroundColor: \"#00838F\", color: \"#FFFFFF\" }\r\n                      : {}\r\n                  }\r\n                  onClick={() => this.handleMeridiem(index, \"AM\")}\r\n                  className=\"meridiemBox\"\r\n                >\r\n                  AM\r\n                </div>\r\n                <div\r\n                  role=\"button\"\r\n                  tabIndex={-42}\r\n                  style={\r\n                    availability.meridiem === \"both\" ||\r\n                    availability.meridiem === \"PM\"\r\n                      ? { backgroundColor: \"#00838F\", color: \"#FFFFFF\" }\r\n                      : {}\r\n                  }\r\n                  onClick={() => this.handleMeridiem(index, \"PM\")}\r\n                  className=\"meridiemBox\"\r\n                >\r\n                  PM\r\n                </div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        );\r\n      case 4:\r\n        return isMobile ? (\r\n          <div className=\"row no-gutters\">\r\n            <p>{texts.desktopPrompt}</p>\r\n          </div>\r\n        ) : (\r\n          <ManagePlanSolution\r\n            plan={plan}\r\n            parentsProfiles={parentsProfiles}\r\n            childrenProfiles={childrenProfiles}\r\n            handleEdits={this.handleSolutionEditing}\r\n            handleFilter={this.handleTimeslotsFilter}\r\n            handleCreation={this.handleActivitesCreation}\r\n          />\r\n        );\r\n      case 5:\r\n        return (\r\n          <div>\r\n            <div className=\"row no-gutters\" style={{ marginTop: \"2rem\" }}>\r\n              <div className=\"categoryText\">\r\n                {texts.zeroVolunteersTimeslots}\r\n              </div>\r\n              <div style={{ width: \"100\" }}>\r\n                <Select\r\n                  value={timeslotsFilter}\r\n                  onChange={event => {\r\n                    this.setState({ timeslotsFilter: event.target.value });\r\n                  }}\r\n                >\r\n                  <MenuItem value=\"create\">\r\n                    <div className=\"categoryText\">{texts.create}</div>\r\n                  </MenuItem>\r\n                  <MenuItem value=\"discard\">\r\n                    <div className=\"categoryText\">{texts.discard}</div>\r\n                  </MenuItem>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n            <div className=\"row no-gutters\" style={{ marginTop: \"2rem\" }}>\r\n              <div className=\"categoryText\">{texts.activitiesCreation}</div>\r\n              <div style={{ width: \"100\" }}>\r\n                <Select\r\n                  value={activitiesCreation}\r\n                  onChange={event => {\r\n                    this.setState({ activitiesCreation: event.target.value });\r\n                  }}\r\n                >\r\n                  <MenuItem value=\"automatically\">\r\n                    <div className=\"categoryText\">{texts.automatically}</div>\r\n                  </MenuItem>\r\n                  <MenuItem value=\"manually\">\r\n                    <div className=\"categoryText\">{texts.manually}</div>\r\n                  </MenuItem>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n            <div\r\n              className=\"row no-gutters\"\r\n              style={{ marginTop: \"2rem\", alignItems: \"center\" }}\r\n            >\r\n              <div className=\"categoryText\">{texts.amTimeslotFrom}</div>\r\n              <input\r\n                name=\"amStartTime\"\r\n                type=\"time\"\r\n                value={amStartTime}\r\n                onChange={this.handleTimeChange}\r\n                className=\"expandedTimeslotTimeInput form-control\"\r\n                required\r\n              />\r\n              <div className=\"categoryText\">{texts.amTimeslotTo}</div>\r\n              <input\r\n                name=\"amEndTime\"\r\n                type=\"time\"\r\n                value={amEndTime}\r\n                onChange={this.handleTimeChange}\r\n                className=\"expandedTimeslotTimeInput form-control\"\r\n                required\r\n              />\r\n            </div>\r\n            <div\r\n              className=\"row no-gutters\"\r\n              style={{ marginTop: \"2rem\", alignItems: \"center\" }}\r\n            >\r\n              <div className=\"categoryText\">{texts.pmTimeslotFrom}</div>\r\n              <input\r\n                name=\"pmStartTime\"\r\n                type=\"time\"\r\n                value={pmStartTime}\r\n                onChange={this.handleTimeChange}\r\n                className=\"expandedTimeslotTimeInput form-control\"\r\n                required\r\n              />\r\n              <div className=\"categoryText\">{texts.pmTimeslotTo}</div>\r\n              <input\r\n                name=\"pmEndTime\"\r\n                type=\"time\"\r\n                value={pmEndTime}\r\n                onChange={this.handleTimeChange}\r\n                className=\"expandedTimeslotTimeInput form-control\"\r\n                required\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      default:\r\n        return <div>Lorem Ipsum</div>;\r\n    }\r\n  };\r\n\r\n  getContinueText = (activeStep, planStep) => {\r\n    const { language } = this.props;\r\n    const texts = Texts[language].managePlanStepper;\r\n    if (\r\n      (activeStep === 1 && planStep === 0) ||\r\n      (activeStep === 3 && planStep === 2)\r\n    ) {\r\n      return texts.finish;\r\n    }\r\n    if (planStep === 4) {\r\n      if (activeStep === 4 && isMobile) {\r\n        return texts.link;\r\n      }\r\n      if (activeStep === 5) {\r\n        return texts.activitiesCreation;\r\n      }\r\n    }\r\n    return texts.continue;\r\n  };\r\n\r\n  render() {\r\n    const { classes, language, userIsAdmin } = this.props;\r\n    const texts = Texts[language].managePlanStepper;\r\n    const steps = texts.stepLabels;\r\n    const {\r\n      activeStep,\r\n      updatingPlan,\r\n      plan: { step: planStep }\r\n    } = this.state;\r\n\r\n    return !updatingPlan ? (\r\n      <div className={classes.root}>\r\n        <MuiThemeProvider theme={muiTheme}>\r\n          <Stepper activeStep={activeStep} orientation=\"vertical\">\r\n            {steps.map(\r\n              (label, index) =>\r\n                (index < 4 || userIsAdmin) && (\r\n                  <Step key={label}>\r\n                    <StepLabel className={classes.stepLabel}>{label}</StepLabel>\r\n                    <StepContent>\r\n                      {this.getStepContent()}\r\n                      <div className={classes.actionsContainer}>\r\n                        <div>\r\n                          <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            onClick={this.handleContinue}\r\n                            className={classes.continueButton}\r\n                          >\r\n                            {this.getContinueText(activeStep, planStep)}\r\n                          </Button>\r\n                          <Button\r\n                            disabled={\r\n                              activeStep === 0 || activeStep <= planStep\r\n                            }\r\n                            onClick={this.handleCancel}\r\n                            className={classes.cancelButton}\r\n                          >\r\n                            {texts.cancel}\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </StepContent>\r\n                  </Step>\r\n                )\r\n            )}\r\n          </Stepper>\r\n        </MuiThemeProvider>\r\n      </div>\r\n    ) : (\r\n      <LoadingSpinner />\r\n    );\r\n  }\r\n}\r\n\r\nManagePlanStepper.propTypes = {\r\n  classes: PropTypes.object,\r\n  history: PropTypes.object,\r\n  language: PropTypes.string,\r\n  match: PropTypes.object,\r\n  plan: PropTypes.object,\r\n  myChildren: PropTypes.array,\r\n  enqueueSnackbar: PropTypes.func,\r\n  parentsProfiles: PropTypes.array,\r\n  childrenProfiles: PropTypes.array,\r\n  userIsAdmin: PropTypes.bool\r\n};\r\nexport default withSnackbar(\r\n  withRouter(withLanguage(withStyles(styles)(ManagePlanStepper)))\r\n);\r\n"]},"metadata":{},"sourceType":"module"}