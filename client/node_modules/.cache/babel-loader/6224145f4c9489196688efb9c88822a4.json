{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Green-Wizards\\\\client\\\\src\\\\components\\\\ActivityListItem.js\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport axios from \"axios\";\nimport { Skeleton } from \"antd\";\nimport { withRouter } from \"react-router-dom\";\nimport moment from \"moment\";\nimport Texts from \"../Constants/Texts\";\nimport withLanguage from \"./LanguageContext\";\nimport Log from \"./Log\";\n\nvar getUsersChildren = function getUsersChildren(userId) {\n  return axios.get(\"/api/users/\".concat(userId, \"/children\")).then(function (response) {\n    return response.data.map(function (child) {\n      return child.child_id;\n    });\n  }).catch(function (error) {\n    Log.error(error);\n    return [];\n  });\n};\n\nvar getTimeslots = function getTimeslots(groupId, activityId) {\n  return axios.get(\"/api/groups/\".concat(groupId, \"/activities/\").concat(activityId, \"/timeslots\")).then(function (response) {\n    return response.data;\n  }).catch(function (error) {\n    Log.error(error);\n    return [];\n  });\n};\n\nvar ActivityListItem = /*#__PURE__*/function (_React$Component) {\n  _inherits(ActivityListItem, _React$Component);\n\n  var _super = _createSuper(ActivityListItem);\n\n  function ActivityListItem(props) {\n    var _this;\n\n    _classCallCheck(this, ActivityListItem);\n\n    _this = _super.call(this, props);\n\n    _this.handleActivityClick = function (event) {\n      var history = _this.props.history;\n      var pathname = history.location.pathname;\n      history.push(\"\".concat(pathname, \"/\").concat(event.currentTarget.id));\n    };\n\n    _this.getDatesString = function () {\n      var language = _this.props.language;\n      var activity = _this.state.activity;\n      var selectedDates = activity.dates;\n      var texts = Texts[language].activityListItem;\n      var datesString = \"\";\n\n      if (activity.repetition_type === \"monthly\") {\n        datesString = \"\".concat(texts.every, \" \").concat(moment(selectedDates[0]).format(\"Do\"));\n      } else {\n        var eachMonthsDates = {};\n        selectedDates.forEach(function (selectedDate) {\n          var key = moment(selectedDate).format(\"MMMM YYYY\");\n\n          if (eachMonthsDates[key] === undefined) {\n            eachMonthsDates[key] = [selectedDate];\n          } else {\n            eachMonthsDates[key].push(selectedDate);\n          }\n        });\n        var months = Object.keys(eachMonthsDates);\n        var dates = Object.values(eachMonthsDates);\n\n        for (var i = 0; i < months.length; i += 1) {\n          var monthString = \"\";\n          dates[i].forEach(function (date) {\n            monthString += \" \".concat(moment(date).format(\"DD\"), \",\");\n          });\n          monthString = monthString.substr(0, monthString.length - 1);\n          monthString += \" \".concat(months[i]);\n          datesString += \" \".concat(monthString, \", \");\n        }\n\n        datesString = datesString.substr(0, datesString.length - 2);\n      }\n\n      return datesString;\n    };\n\n    var _activity = _this.props.activity;\n    _this.state = {\n      fetchedTimeslots: false,\n      activity: _activity\n    };\n    return _this;\n  }\n\n  _createClass(ActivityListItem, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var activity, userId, groupId, activityId, usersChildren, timeslots, dates, uniqueDates, temp, i, parents, children, userSubscribed, childrenSubscribed, j;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                activity = this.state.activity;\n                userId = JSON.parse(localStorage.getItem(\"user\")).id;\n                groupId = this.props.groupId;\n                activityId = activity.activity_id;\n                _context.next = 6;\n                return getUsersChildren(userId);\n\n              case 6:\n                usersChildren = _context.sent;\n                _context.next = 9;\n                return getTimeslots(groupId, activityId);\n\n              case 9:\n                timeslots = _context.sent;\n                dates = timeslots.map(function (timeslot) {\n                  return timeslot.start.dateTime;\n                });\n                dates = dates.sort(function (a, b) {\n                  return new Date(a) - new Date(b);\n                });\n                uniqueDates = [];\n                temp = [];\n                dates.forEach(function (date) {\n                  var t = moment(date).format(\"DD-MM-YYYY\");\n\n                  if (!temp.includes(t)) {\n                    temp.push(t);\n                    uniqueDates.push(date);\n                  }\n                });\n                activity.subscribed = false;\n                i = 0;\n\n              case 17:\n                if (!(i < timeslots.length)) {\n                  _context.next = 36;\n                  break;\n                }\n\n                parents = JSON.parse(timeslots[i].extendedProperties.shared.parents);\n                children = JSON.parse(timeslots[i].extendedProperties.shared.children);\n                userSubscribed = parents.includes(userId);\n                childrenSubscribed = false;\n                j = 0;\n\n              case 23:\n                if (!(j < usersChildren.length)) {\n                  _context.next = 30;\n                  break;\n                }\n\n                if (!children.includes(usersChildren[j])) {\n                  _context.next = 27;\n                  break;\n                }\n\n                childrenSubscribed = true;\n                return _context.abrupt(\"break\", 30);\n\n              case 27:\n                j += 1;\n                _context.next = 23;\n                break;\n\n              case 30:\n                if (!(userSubscribed || childrenSubscribed)) {\n                  _context.next = 33;\n                  break;\n                }\n\n                activity.subscribed = true;\n                return _context.abrupt(\"break\", 36);\n\n              case 33:\n                i += 1;\n                _context.next = 17;\n                break;\n\n              case 36:\n                activity.dates = uniqueDates;\n                this.setState({\n                  fetchedTimeslots: true,\n                  activity: activity\n                });\n\n              case 38:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          activity = _this$state.activity,\n          fetchedTimeslots = _this$state.fetchedTimeslots;\n      return fetchedTimeslots ? /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        role: \"button\",\n        tabIndex: \"0\",\n        onKeyPress: this.handleActivityClick,\n        className: \"row no-gutters\",\n        style: {\n          minHheight: \"7rem\",\n          cursor: \"pointer\"\n        },\n        id: activity.activity_id,\n        onClick: this.handleActivityClick,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 9\n        }\n      }, activity.subscribed && /*#__PURE__*/React.createElement(\"div\", {\n        className: \"activityListItemIcon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fas fa-user-check\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 15\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-2-10\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        style: {\n          fontSize: \"3rem\",\n          color: activity.color\n        },\n        className: \"fas fa-certificate center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-6-10\",\n        style: {\n          borderBottom: \"1px solid rgba(0,0,0,0.1)\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"verticalCenter\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row no-gutters\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 17\n        }\n      }, activity.name)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row no-gutters\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"far fa-calendar-alt\",\n        style: {\n          marginRight: \"1rem\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"h2\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 17\n        }\n      }, this.getDatesString())))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-2-10\",\n        style: {\n          borderBottom: \"1px solid rgba(0,0,0,0.1)\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        style: {\n          fontSize: \"2rem\"\n        },\n        className: \"fas fa-chevron-right center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 13\n        }\n      })))) : /*#__PURE__*/React.createElement(Skeleton, {\n        avatar: true,\n        active: true,\n        paragraph: {\n          rows: 1\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return ActivityListItem;\n}(React.Component);\n\nexport default withRouter(withLanguage(ActivityListItem));\nActivityListItem.propTypes = {\n  activity: PropTypes.object,\n  groupId: PropTypes.string,\n  history: PropTypes.object,\n  language: PropTypes.string\n};","map":{"version":3,"sources":["C:/Users/nucle/Documents/GitHub/Green-Wizards/client/src/components/ActivityListItem.js"],"names":["React","PropTypes","axios","Skeleton","withRouter","moment","Texts","withLanguage","Log","getUsersChildren","userId","get","then","response","data","map","child","child_id","catch","error","getTimeslots","groupId","activityId","ActivityListItem","props","handleActivityClick","event","history","pathname","location","push","currentTarget","id","getDatesString","language","activity","state","selectedDates","dates","texts","activityListItem","datesString","repetition_type","every","format","eachMonthsDates","forEach","selectedDate","key","undefined","months","Object","keys","values","i","length","monthString","date","substr","fetchedTimeslots","JSON","parse","localStorage","getItem","activity_id","usersChildren","timeslots","timeslot","start","dateTime","sort","a","b","Date","uniqueDates","temp","t","includes","subscribed","parents","extendedProperties","shared","children","userSubscribed","childrenSubscribed","j","setState","minHheight","cursor","fontSize","color","borderBottom","name","marginRight","rows","Component","propTypes","object","string"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport axios from \"axios\";\r\nimport { Skeleton } from \"antd\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport moment from \"moment\";\r\nimport Texts from \"../Constants/Texts\";\r\nimport withLanguage from \"./LanguageContext\";\r\nimport Log from \"./Log\";\r\n\r\nconst getUsersChildren = userId => {\r\n  return axios\r\n    .get(`/api/users/${userId}/children`)\r\n    .then(response => {\r\n      return response.data.map(child => child.child_id);\r\n    })\r\n    .catch(error => {\r\n      Log.error(error);\r\n      return [];\r\n    });\r\n};\r\n\r\nconst getTimeslots = (groupId, activityId) => {\r\n  return axios\r\n    .get(`/api/groups/${groupId}/activities/${activityId}/timeslots`)\r\n    .then(response => {\r\n      return response.data;\r\n    })\r\n    .catch(error => {\r\n      Log.error(error);\r\n      return [];\r\n    });\r\n};\r\n\r\nclass ActivityListItem extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const { activity } = this.props;\r\n    this.state = { fetchedTimeslots: false, activity };\r\n  }\r\n\r\n  async componentDidMount() {\r\n    const { activity } = this.state;\r\n    const userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n    const { groupId } = this.props;\r\n    const activityId = activity.activity_id;\r\n    const usersChildren = await getUsersChildren(userId);\r\n    const timeslots = await getTimeslots(groupId, activityId);\r\n    let dates = timeslots.map(timeslot => timeslot.start.dateTime);\r\n    dates = dates.sort((a, b) => {\r\n      return new Date(a) - new Date(b);\r\n    });\r\n    const uniqueDates = [];\r\n    const temp = [];\r\n    dates.forEach(date => {\r\n      const t = moment(date).format(\"DD-MM-YYYY\");\r\n      if (!temp.includes(t)) {\r\n        temp.push(t);\r\n        uniqueDates.push(date);\r\n      }\r\n    });\r\n    activity.subscribed = false;\r\n    for (let i = 0; i < timeslots.length; i += 1) {\r\n      const parents = JSON.parse(\r\n        timeslots[i].extendedProperties.shared.parents\r\n      );\r\n      const children = JSON.parse(\r\n        timeslots[i].extendedProperties.shared.children\r\n      );\r\n      const userSubscribed = parents.includes(userId);\r\n      let childrenSubscribed = false;\r\n      for (let j = 0; j < usersChildren.length; j += 1) {\r\n        if (children.includes(usersChildren[j])) {\r\n          childrenSubscribed = true;\r\n          break;\r\n        }\r\n      }\r\n      if (userSubscribed || childrenSubscribed) {\r\n        activity.subscribed = true;\r\n        break;\r\n      }\r\n    }\r\n    activity.dates = uniqueDates;\r\n    this.setState({ fetchedTimeslots: true, activity });\r\n  }\r\n\r\n  handleActivityClick = event => {\r\n    const { history } = this.props;\r\n    const { pathname } = history.location;\r\n    history.push(`${pathname}/${event.currentTarget.id}`);\r\n  };\r\n\r\n  getDatesString = () => {\r\n    const { language } = this.props;\r\n    const { activity } = this.state;\r\n    const selectedDates = activity.dates;\r\n    const texts = Texts[language].activityListItem;\r\n    let datesString = \"\";\r\n    if (activity.repetition_type === \"monthly\") {\r\n      datesString = `${texts.every} ${moment(selectedDates[0]).format(\"Do\")}`;\r\n    } else {\r\n      const eachMonthsDates = {};\r\n      selectedDates.forEach(selectedDate => {\r\n        const key = moment(selectedDate).format(\"MMMM YYYY\");\r\n        if (eachMonthsDates[key] === undefined) {\r\n          eachMonthsDates[key] = [selectedDate];\r\n        } else {\r\n          eachMonthsDates[key].push(selectedDate);\r\n        }\r\n      });\r\n      const months = Object.keys(eachMonthsDates);\r\n      const dates = Object.values(eachMonthsDates);\r\n      for (let i = 0; i < months.length; i += 1) {\r\n        let monthString = \"\";\r\n        dates[i].forEach(date => {\r\n          monthString += ` ${moment(date).format(\"DD\")},`;\r\n        });\r\n        monthString = monthString.substr(0, monthString.length - 1);\r\n        monthString += ` ${months[i]}`;\r\n        datesString += ` ${monthString}, `;\r\n      }\r\n      datesString = datesString.substr(0, datesString.length - 2);\r\n    }\r\n    return datesString;\r\n  };\r\n\r\n  render() {\r\n    const { activity, fetchedTimeslots } = this.state;\r\n    return fetchedTimeslots ? (\r\n      <React.Fragment>\r\n        <div\r\n          role=\"button\"\r\n          tabIndex=\"0\"\r\n          onKeyPress={this.handleActivityClick}\r\n          className=\"row no-gutters\"\r\n          style={{ minHheight: \"7rem\", cursor: \"pointer\" }}\r\n          id={activity.activity_id}\r\n          onClick={this.handleActivityClick}\r\n        >\r\n          {activity.subscribed && (\r\n            <div className=\"activityListItemIcon\">\r\n              <i className=\"fas fa-user-check\" />\r\n            </div>\r\n          )}\r\n          <div className=\"col-2-10\">\r\n            <i\r\n              style={{\r\n                fontSize: \"3rem\",\r\n                color: activity.color\r\n              }}\r\n              className=\"fas fa-certificate center\"\r\n            />\r\n          </div>\r\n          <div\r\n            className=\"col-6-10\"\r\n            style={{ borderBottom: \"1px solid rgba(0,0,0,0.1)\" }}\r\n          >\r\n            <div className=\"verticalCenter\">\r\n              <div className=\"row no-gutters\">\r\n                <h1>{activity.name}</h1>\r\n              </div>\r\n              <div className=\"row no-gutters\">\r\n                <i\r\n                  className=\"far fa-calendar-alt\"\r\n                  style={{ marginRight: \"1rem\" }}\r\n                />\r\n                <h2>{this.getDatesString()}</h2>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div\r\n            className=\"col-2-10\"\r\n            style={{ borderBottom: \"1px solid rgba(0,0,0,0.1)\" }}\r\n          >\r\n            <i\r\n              style={{ fontSize: \"2rem\" }}\r\n              className=\"fas fa-chevron-right center\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </React.Fragment>\r\n    ) : (\r\n      <Skeleton avatar active paragraph={{ rows: 1 }} />\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(withLanguage(ActivityListItem));\r\n\r\nActivityListItem.propTypes = {\r\n  activity: PropTypes.object,\r\n  groupId: PropTypes.string,\r\n  history: PropTypes.object,\r\n  language: PropTypes.string\r\n};\r\n"]},"metadata":{},"sourceType":"module"}