{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _toConsumableArray from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\src\\\\components\\\\AnnouncementBar.js\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport axios from \"axios\";\nimport { withSnackbar } from \"notistack\";\nimport Texts from \"../Constants/Texts\";\nimport withLanguage from \"./LanguageContext\";\nimport PhotoPreviewBubble from \"./PhotoPreviewBubble\";\nimport Log from \"./Log\";\n\nvar dataURLtoFile = function dataURLtoFile(dataurl, filename) {\n  var arr = dataurl.split(\",\");\n  var mime = arr[0].match(/:(.*?);/)[1];\n  var bstr = atob(arr[1]);\n  var n = bstr.length;\n  var u8arr = new Uint8Array(n);\n\n  while (n) {\n    n -= 1;\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n\n  return new File([u8arr], filename, {\n    type: mime\n  });\n};\n\nvar AnnouncementBar = /*#__PURE__*/function (_React$Component) {\n  _inherits(AnnouncementBar, _React$Component);\n\n  var _super = _createSuper(AnnouncementBar);\n\n  function AnnouncementBar() {\n    var _this;\n\n    _classCallCheck(this, AnnouncementBar);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      message: \"\",\n      photos: []\n    };\n\n    _this.handleMessage = function (event) {\n      var data = JSON.parse(event.data);\n\n      if (data.action === \"fileUpload\") {\n        var image = \"data:image/png;base64, \".concat(data.value);\n\n        _this.setState({\n          photos: [{\n            photo: dataURLtoFile(image, \"photo.png\"),\n            preview: image\n          }]\n        });\n      }\n    };\n\n    _this.handleEnter = function (event) {\n      if (event.keyCode === 13) _this.handleSend();\n    };\n\n    _this.handleSend = function () {\n      var _this$props = _this.props,\n          groupId = _this$props.groupId,\n          handleRefresh = _this$props.handleRefresh;\n      var _this$state = _this.state,\n          message = _this$state.message,\n          photos = _this$state.photos;\n\n      if (message || photos.length > 0) {\n        var user_id = JSON.parse(localStorage.getItem(\"user\")).id;\n        var bodyFormData = new FormData();\n\n        if (photos.length > 0) {\n          for (var i = 0; i < photos.length; i += 1) {\n            bodyFormData.append(\"photo\", photos[i].photo);\n          }\n        }\n\n        bodyFormData.append(\"message\", message);\n        bodyFormData.append(\"user_id\", user_id);\n        axios.post(\"/api/groups/\".concat(groupId, \"/announcements\"), bodyFormData).then(function (response) {\n          Log.info(response);\n          handleRefresh();\n        }).catch(function (error) {\n          Log.error(error);\n        });\n\n        _this.setState({\n          message: \"\",\n          photos: []\n        });\n      }\n    };\n\n    _this.handleMessageChange = function (event) {\n      _this.setState({\n        message: event.target.value\n      });\n    };\n\n    _this.getPhotoPreview = function (photo) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n\n        reader.onload = function (e) {\n          var photoWithPrev = photo;\n          photoWithPrev.preview = e.target.result;\n          resolve(photoWithPrev);\n        };\n\n        reader.onerror = function (e) {\n          reject(e);\n        };\n\n        reader.readAsDataURL(photo.photo);\n      });\n    };\n\n    _this.handleImageUpload = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n        var _this$props2, enqueueSnackbar, language, snackMessage, photos, photosWithPreview;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$props2 = _this.props, enqueueSnackbar = _this$props2.enqueueSnackbar, language = _this$props2.language;\n                snackMessage = Texts[language].replyBar.maxFilesError;\n\n                if (!event.target.files) {\n                  _context.next = 12;\n                  break;\n                }\n\n                photos = _toConsumableArray(event.target.files).map(function (file) {\n                  return {\n                    photo: file,\n                    preview: \"\"\n                  };\n                });\n\n                if (!(photos.length > 3)) {\n                  _context.next = 8;\n                  break;\n                }\n\n                enqueueSnackbar(snackMessage, {\n                  variant: \"error\"\n                });\n                _context.next = 12;\n                break;\n\n              case 8:\n                _context.next = 10;\n                return Promise.all(photos.map(function (photo) {\n                  return _this.getPhotoPreview(photo);\n                }));\n\n              case 10:\n                photosWithPreview = _context.sent;\n\n                _this.setState({\n                  photos: photosWithPreview\n                });\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleNativeImageChange = function () {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        action: \"fileUpload\"\n      }));\n    };\n\n    _this.handlePreviewDelete = function (photo) {\n      var photos = _this.state.photos;\n\n      _this.setState({\n        photos: photos.filter(function (p) {\n          return p.preview !== photo.preview;\n        })\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(AnnouncementBar, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener(\"message\", this.handleMessage, false);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(\"message\", this.handleMessage, false);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var language = this.props.language;\n      var texts = Texts[language].replyBar;\n      var _this$state2 = this.state,\n          photos = _this$state2.photos,\n          message = _this$state2.message;\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(PhotoPreviewBubble, {\n        photos: photos,\n        handleDelete: this.handlePreviewDelete,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        id: \"announcementBarContainer\",\n        className: \"row no-gutters\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        id: \"announcementBubble\",\n        className: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row no-gutters verticalCenter\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-7-10\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"center\",\n        value: message,\n        placeholder: texts.new,\n        onChange: this.handleMessageChange,\n        onKeyUp: this.handleEnter,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 17\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-3-10\",\n        id: \"announcementBubbleButtons\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        htmlFor: \"uploadPhotoInput\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        role: \"button\",\n        tabIndex: \"-1\",\n        className: \"fas fa-camera\",\n        onClick: function onClick() {\n          return window.isNative ? _this2.handleNativeImageChange() : {};\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 19\n        }\n      }), !window.isNative && /*#__PURE__*/React.createElement(\"input\", {\n        id: \"uploadPhotoInput\",\n        type: \"file\",\n        accept: \"image/*\",\n        name: \"photo\",\n        multiple: true,\n        onChange: this.handleImageUpload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 21\n        }\n      })), /*#__PURE__*/React.createElement(\"i\", {\n        role: \"button\",\n        tabIndex: \"-1\",\n        className: \"fas fa-paper-plane\",\n        onClick: this.handleSend,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 17\n        }\n      }))))));\n    }\n  }]);\n\n  return AnnouncementBar;\n}(React.Component);\n\nAnnouncementBar.propTypes = {\n  handleRefresh: PropTypes.func,\n  groupId: PropTypes.string,\n  language: PropTypes.string,\n  enqueueSnackbar: PropTypes.func\n};\nexport default withSnackbar(withLanguage(AnnouncementBar));","map":{"version":3,"sources":["C:/Users/nucle/Documents/GitHub/Families_Share-platform/client/src/components/AnnouncementBar.js"],"names":["React","PropTypes","axios","withSnackbar","Texts","withLanguage","PhotoPreviewBubble","Log","dataURLtoFile","dataurl","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","type","AnnouncementBar","state","message","photos","handleMessage","event","data","JSON","parse","action","image","value","setState","photo","preview","handleEnter","keyCode","handleSend","props","groupId","handleRefresh","user_id","localStorage","getItem","id","bodyFormData","FormData","i","append","post","then","response","info","catch","error","handleMessageChange","target","getPhotoPreview","Promise","resolve","reject","reader","FileReader","onload","e","photoWithPrev","result","onerror","readAsDataURL","handleImageUpload","enqueueSnackbar","language","snackMessage","replyBar","maxFilesError","files","map","file","variant","all","photosWithPreview","handleNativeImageChange","window","ReactNativeWebView","postMessage","stringify","handlePreviewDelete","filter","p","document","addEventListener","removeEventListener","texts","new","isNative","Component","propTypes","func","string"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,YAAT,QAA6B,WAA7B;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AACA,OAAOC,YAAP,MAAyB,mBAAzB;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,OAAOC,GAAP,MAAgB,OAAhB;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,OAAD,EAAUC,QAAV,EAAuB;AAC3C,MAAMC,GAAG,GAAGF,OAAO,CAACG,KAAR,CAAc,GAAd,CAAZ;AAEA,MAAMC,IAAI,GAAGF,GAAG,CAAC,CAAD,CAAH,CAAOG,KAAP,CAAa,SAAb,EAAwB,CAAxB,CAAb;AAEA,MAAMC,IAAI,GAAGC,IAAI,CAACL,GAAG,CAAC,CAAD,CAAJ,CAAjB;AAEA,MAAIM,CAAC,GAAGF,IAAI,CAACG,MAAb;AAEA,MAAMC,KAAK,GAAG,IAAIC,UAAJ,CAAeH,CAAf,CAAd;;AACA,SAAOA,CAAP,EAAU;AACRA,IAAAA,CAAC,IAAI,CAAL;AACAE,IAAAA,KAAK,CAACF,CAAD,CAAL,GAAWF,IAAI,CAACM,UAAL,CAAgBJ,CAAhB,CAAX;AACD;;AACD,SAAO,IAAIK,IAAJ,CAAS,CAACH,KAAD,CAAT,EAAkBT,QAAlB,EAA4B;AAAEa,IAAAA,IAAI,EAAEV;AAAR,GAA5B,CAAP;AACD,CAfD;;IAiBMW,e;;;;;;;;;;;;;;;UACJC,K,GAAQ;AAAEC,MAAAA,OAAO,EAAE,EAAX;AAAeC,MAAAA,MAAM,EAAE;AAAvB,K;;UAURC,a,GAAgB,UAAAC,KAAK,EAAI;AACvB,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWH,KAAK,CAACC,IAAjB,CAAb;;AACA,UAAIA,IAAI,CAACG,MAAL,KAAgB,YAApB,EAAkC;AAChC,YAAMC,KAAK,oCAA6BJ,IAAI,CAACK,KAAlC,CAAX;;AACA,cAAKC,QAAL,CAAc;AACZT,UAAAA,MAAM,EAAE,CAAC;AAAEU,YAAAA,KAAK,EAAE7B,aAAa,CAAC0B,KAAD,EAAQ,WAAR,CAAtB;AAA4CI,YAAAA,OAAO,EAAEJ;AAArD,WAAD;AADI,SAAd;AAGD;AACF,K;;UAEDK,W,GAAc,UAAAV,KAAK,EAAI;AACrB,UAAIA,KAAK,CAACW,OAAN,KAAkB,EAAtB,EAA0B,MAAKC,UAAL;AAC3B,K;;UAEDA,U,GAAa,YAAM;AAAA,wBACkB,MAAKC,KADvB;AAAA,UACTC,OADS,eACTA,OADS;AAAA,UACAC,aADA,eACAA,aADA;AAAA,wBAEW,MAAKnB,KAFhB;AAAA,UAETC,OAFS,eAETA,OAFS;AAAA,UAEAC,MAFA,eAEAA,MAFA;;AAGjB,UAAID,OAAO,IAAIC,MAAM,CAACT,MAAP,GAAgB,CAA/B,EAAkC;AAChC,YAAM2B,OAAO,GAAGd,IAAI,CAACC,KAAL,CAAWc,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX,EAAyCC,EAAzD;AACA,YAAMC,YAAY,GAAG,IAAIC,QAAJ,EAArB;;AACA,YAAIvB,MAAM,CAACT,MAAP,GAAgB,CAApB,EAAuB;AACrB,eAAK,IAAIiC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxB,MAAM,CAACT,MAA3B,EAAmCiC,CAAC,IAAI,CAAxC,EAA2C;AACzCF,YAAAA,YAAY,CAACG,MAAb,CAAoB,OAApB,EAA6BzB,MAAM,CAACwB,CAAD,CAAN,CAAUd,KAAvC;AACD;AACF;;AACDY,QAAAA,YAAY,CAACG,MAAb,CAAoB,SAApB,EAA+B1B,OAA/B;AACAuB,QAAAA,YAAY,CAACG,MAAb,CAAoB,SAApB,EAA+BP,OAA/B;AACA3C,QAAAA,KAAK,CACFmD,IADH,uBACuBV,OADvB,qBACgDM,YADhD,EAEGK,IAFH,CAEQ,UAAAC,QAAQ,EAAI;AAChBhD,UAAAA,GAAG,CAACiD,IAAJ,CAASD,QAAT;AACAX,UAAAA,aAAa;AACd,SALH,EAMGa,KANH,CAMS,UAAAC,KAAK,EAAI;AACdnD,UAAAA,GAAG,CAACmD,KAAJ,CAAUA,KAAV;AACD,SARH;;AASA,cAAKtB,QAAL,CAAc;AAAEV,UAAAA,OAAO,EAAE,EAAX;AAAeC,UAAAA,MAAM,EAAE;AAAvB,SAAd;AACD;AACF,K;;UAEDgC,mB,GAAsB,UAAA9B,KAAK,EAAI;AAC7B,YAAKO,QAAL,CAAc;AAAEV,QAAAA,OAAO,EAAEG,KAAK,CAAC+B,MAAN,CAAazB;AAAxB,OAAd;AACD,K;;UAED0B,e,GAAkB,UAAAxB,KAAK,EAAI;AACzB,aAAO,IAAIyB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,YAAMC,MAAM,GAAG,IAAIC,UAAJ,EAAf;;AACAD,QAAAA,MAAM,CAACE,MAAP,GAAgB,UAAAC,CAAC,EAAI;AACnB,cAAMC,aAAa,GAAGhC,KAAtB;AACAgC,UAAAA,aAAa,CAAC/B,OAAd,GAAwB8B,CAAC,CAACR,MAAF,CAASU,MAAjC;AACAP,UAAAA,OAAO,CAACM,aAAD,CAAP;AACD,SAJD;;AAKAJ,QAAAA,MAAM,CAACM,OAAP,GAAiB,UAAAH,CAAC,EAAI;AACpBJ,UAAAA,MAAM,CAACI,CAAD,CAAN;AACD,SAFD;;AAGAH,QAAAA,MAAM,CAACO,aAAP,CAAqBnC,KAAK,CAACA,KAA3B;AACD,OAXM,CAAP;AAYD,K;;UAEDoC,iB;0EAAoB,iBAAM5C,KAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,+BACoB,MAAKa,KADzB,EACVgC,eADU,gBACVA,eADU,EACOC,QADP,gBACOA,QADP;AAEZC,gBAAAA,YAFY,GAEGxE,KAAK,CAACuE,QAAD,CAAL,CAAgBE,QAAhB,CAAyBC,aAF5B;;AAAA,qBAGdjD,KAAK,CAAC+B,MAAN,CAAamB,KAHC;AAAA;AAAA;AAAA;;AAIVpD,gBAAAA,MAJU,GAID,mBAAIE,KAAK,CAAC+B,MAAN,CAAamB,KAAjB,EAAwBC,GAAxB,CAA4B,UAAAC,IAAI,EAAI;AACjD,yBAAO;AAAE5C,oBAAAA,KAAK,EAAE4C,IAAT;AAAe3C,oBAAAA,OAAO,EAAE;AAAxB,mBAAP;AACD,iBAFc,CAJC;;AAAA,sBAOZX,MAAM,CAACT,MAAP,GAAgB,CAPJ;AAAA;AAAA;AAAA;;AAQdwD,gBAAAA,eAAe,CAACE,YAAD,EAAe;AAC5BM,kBAAAA,OAAO,EAAE;AADmB,iBAAf,CAAf;AARc;AAAA;;AAAA;AAAA;AAAA,uBAYkBpB,OAAO,CAACqB,GAAR,CAC9BxD,MAAM,CAACqD,GAAP,CAAW,UAAA3C,KAAK;AAAA,yBAAI,MAAKwB,eAAL,CAAqBxB,KAArB,CAAJ;AAAA,iBAAhB,CAD8B,CAZlB;;AAAA;AAYR+C,gBAAAA,iBAZQ;;AAed,sBAAKhD,QAAL,CAAc;AAAET,kBAAAA,MAAM,EAAEyD;AAAV,iBAAd;;AAfc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;UAoBpBC,uB,GAA0B,YAAM;AAC9BC,MAAAA,MAAM,CAACC,kBAAP,CAA0BC,WAA1B,CACEzD,IAAI,CAAC0D,SAAL,CAAe;AAAExD,QAAAA,MAAM,EAAE;AAAV,OAAf,CADF;AAGD,K;;UAEDyD,mB,GAAsB,UAAArD,KAAK,EAAI;AAAA,UACrBV,MADqB,GACV,MAAKF,KADK,CACrBE,MADqB;;AAE7B,YAAKS,QAAL,CAAc;AACZT,QAAAA,MAAM,EAAEA,MAAM,CAACgE,MAAP,CAAc,UAAAC,CAAC;AAAA,iBAAIA,CAAC,CAACtD,OAAF,KAAcD,KAAK,CAACC,OAAxB;AAAA,SAAf;AADI,OAAd;AAGD,K;;;;;;;wCAlGmB;AAClBuD,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqC,KAAKlE,aAA1C,EAAyD,KAAzD;AACD;;;2CAEsB;AACrBiE,MAAAA,QAAQ,CAACE,mBAAT,CAA6B,SAA7B,EAAwC,KAAKnE,aAA7C,EAA4D,KAA5D;AACD;;;6BA8FQ;AAAA;;AAAA,UACC+C,QADD,GACc,KAAKjC,KADnB,CACCiC,QADD;AAEP,UAAMqB,KAAK,GAAG5F,KAAK,CAACuE,QAAD,CAAL,CAAgBE,QAA9B;AAFO,yBAGqB,KAAKpD,KAH1B;AAAA,UAGCE,MAHD,gBAGCA,MAHD;AAAA,UAGSD,OAHT,gBAGSA,OAHT;AAIP,0BACE,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,kBAAD;AACE,QAAA,MAAM,EAAEC,MADV;AAEE,QAAA,YAAY,EAAE,KAAK+D,mBAFrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,eAKE;AAAK,QAAA,EAAE,EAAC,0BAAR;AAAmC,QAAA,SAAS,EAAC,gBAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,EAAE,EAAC,oBAAR;AAA6B,QAAA,SAAS,EAAC,QAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,+BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,QAFZ;AAGE,QAAA,KAAK,EAAEhE,OAHT;AAIE,QAAA,WAAW,EAAEsE,KAAK,CAACC,GAJrB;AAKE,QAAA,QAAQ,EAAE,KAAKtC,mBALjB;AAME,QAAA,OAAO,EAAE,KAAKpB,WANhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,eAWE;AAAK,QAAA,SAAS,EAAC,UAAf;AAA0B,QAAA,EAAE,EAAC,2BAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,OAAO,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,QAAQ,EAAC,IAFX;AAGE,QAAA,SAAS,EAAC,eAHZ;AAIE,QAAA,OAAO,EAAE;AAAA,iBACP+C,MAAM,CAACY,QAAP,GAAkB,MAAI,CAACb,uBAAL,EAAlB,GAAmD,EAD5C;AAAA,SAJX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EASG,CAACC,MAAM,CAACY,QAAR,iBACC;AACE,QAAA,EAAE,EAAC,kBADL;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,MAAM,EAAC,SAHT;AAIE,QAAA,IAAI,EAAC,OAJP;AAKE,QAAA,QAAQ,MALV;AAME,QAAA,QAAQ,EAAE,KAAKzB,iBANjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAVJ,CADF,eAqBE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,QAAQ,EAAC,IAFX;AAGE,QAAA,SAAS,EAAC,oBAHZ;AAIE,QAAA,OAAO,EAAE,KAAKhC,UAJhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QArBF,CAXF,CADF,CADF,CALF,CADF;AAoDD;;;;EA/J2BzC,KAAK,CAACmG,S;;AAkKpC3E,eAAe,CAAC4E,SAAhB,GAA4B;AAC1BxD,EAAAA,aAAa,EAAE3C,SAAS,CAACoG,IADC;AAE1B1D,EAAAA,OAAO,EAAE1C,SAAS,CAACqG,MAFO;AAG1B3B,EAAAA,QAAQ,EAAE1E,SAAS,CAACqG,MAHM;AAI1B5B,EAAAA,eAAe,EAAEzE,SAAS,CAACoG;AAJD,CAA5B;AAOA,eAAelG,YAAY,CAACE,YAAY,CAACmB,eAAD,CAAb,CAA3B","sourcesContent":["import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport axios from \"axios\";\r\nimport { withSnackbar } from \"notistack\";\r\nimport Texts from \"../Constants/Texts\";\r\nimport withLanguage from \"./LanguageContext\";\r\nimport PhotoPreviewBubble from \"./PhotoPreviewBubble\";\r\nimport Log from \"./Log\";\r\n\r\nconst dataURLtoFile = (dataurl, filename) => {\r\n  const arr = dataurl.split(\",\");\r\n\r\n  const mime = arr[0].match(/:(.*?);/)[1];\r\n\r\n  const bstr = atob(arr[1]);\r\n\r\n  let n = bstr.length;\r\n\r\n  const u8arr = new Uint8Array(n);\r\n  while (n) {\r\n    n -= 1;\r\n    u8arr[n] = bstr.charCodeAt(n);\r\n  }\r\n  return new File([u8arr], filename, { type: mime });\r\n};\r\n\r\nclass AnnouncementBar extends React.Component {\r\n  state = { message: \"\", photos: [] };\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"message\", this.handleMessage, false);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"message\", this.handleMessage, false);\r\n  }\r\n\r\n  handleMessage = event => {\r\n    const data = JSON.parse(event.data);\r\n    if (data.action === \"fileUpload\") {\r\n      const image = `data:image/png;base64, ${data.value}`;\r\n      this.setState({\r\n        photos: [{ photo: dataURLtoFile(image, \"photo.png\"), preview: image }]\r\n      });\r\n    }\r\n  };\r\n\r\n  handleEnter = event => {\r\n    if (event.keyCode === 13) this.handleSend();\r\n  };\r\n\r\n  handleSend = () => {\r\n    const { groupId, handleRefresh } = this.props;\r\n    const { message, photos } = this.state;\r\n    if (message || photos.length > 0) {\r\n      const user_id = JSON.parse(localStorage.getItem(\"user\")).id;\r\n      const bodyFormData = new FormData();\r\n      if (photos.length > 0) {\r\n        for (let i = 0; i < photos.length; i += 1) {\r\n          bodyFormData.append(\"photo\", photos[i].photo);\r\n        }\r\n      }\r\n      bodyFormData.append(\"message\", message);\r\n      bodyFormData.append(\"user_id\", user_id);\r\n      axios\r\n        .post(`/api/groups/${groupId}/announcements`, bodyFormData)\r\n        .then(response => {\r\n          Log.info(response);\r\n          handleRefresh();\r\n        })\r\n        .catch(error => {\r\n          Log.error(error);\r\n        });\r\n      this.setState({ message: \"\", photos: [] });\r\n    }\r\n  };\r\n\r\n  handleMessageChange = event => {\r\n    this.setState({ message: event.target.value });\r\n  };\r\n\r\n  getPhotoPreview = photo => {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = e => {\r\n        const photoWithPrev = photo;\r\n        photoWithPrev.preview = e.target.result;\r\n        resolve(photoWithPrev);\r\n      };\r\n      reader.onerror = e => {\r\n        reject(e);\r\n      };\r\n      reader.readAsDataURL(photo.photo);\r\n    });\r\n  };\r\n\r\n  handleImageUpload = async event => {\r\n    const { enqueueSnackbar, language } = this.props;\r\n    const snackMessage = Texts[language].replyBar.maxFilesError;\r\n    if (event.target.files) {\r\n      const photos = [...event.target.files].map(file => {\r\n        return { photo: file, preview: \"\" };\r\n      });\r\n      if (photos.length > 3) {\r\n        enqueueSnackbar(snackMessage, {\r\n          variant: \"error\"\r\n        });\r\n      } else {\r\n        const photosWithPreview = await Promise.all(\r\n          photos.map(photo => this.getPhotoPreview(photo))\r\n        );\r\n        this.setState({ photos: photosWithPreview });\r\n      }\r\n    }\r\n  };\r\n\r\n  handleNativeImageChange = () => {\r\n    window.ReactNativeWebView.postMessage(\r\n      JSON.stringify({ action: \"fileUpload\" })\r\n    );\r\n  };\r\n\r\n  handlePreviewDelete = photo => {\r\n    const { photos } = this.state;\r\n    this.setState({\r\n      photos: photos.filter(p => p.preview !== photo.preview)\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { language } = this.props;\r\n    const texts = Texts[language].replyBar;\r\n    const { photos, message } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <PhotoPreviewBubble\r\n          photos={photos}\r\n          handleDelete={this.handlePreviewDelete}\r\n        />\r\n        <div id=\"announcementBarContainer\" className=\"row no-gutters\">\r\n          <div id=\"announcementBubble\" className=\"center\">\r\n            <div className=\"row no-gutters verticalCenter\">\r\n              <div className=\"col-7-10\">\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"center\"\r\n                  value={message}\r\n                  placeholder={texts.new}\r\n                  onChange={this.handleMessageChange}\r\n                  onKeyUp={this.handleEnter}\r\n                />\r\n              </div>\r\n              <div className=\"col-3-10\" id=\"announcementBubbleButtons\">\r\n                <label htmlFor=\"uploadPhotoInput\">\r\n                  <i\r\n                    role=\"button\"\r\n                    tabIndex=\"-1\"\r\n                    className=\"fas fa-camera\"\r\n                    onClick={() =>\r\n                      window.isNative ? this.handleNativeImageChange() : {}\r\n                    }\r\n                  />\r\n                  {!window.isNative && (\r\n                    <input\r\n                      id=\"uploadPhotoInput\"\r\n                      type=\"file\"\r\n                      accept=\"image/*\"\r\n                      name=\"photo\"\r\n                      multiple\r\n                      onChange={this.handleImageUpload}\r\n                    />\r\n                  )}\r\n                </label>\r\n                <i\r\n                  role=\"button\"\r\n                  tabIndex=\"-1\"\r\n                  className=\"fas fa-paper-plane\"\r\n                  onClick={this.handleSend}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nAnnouncementBar.propTypes = {\r\n  handleRefresh: PropTypes.func,\r\n  groupId: PropTypes.string,\r\n  language: PropTypes.string,\r\n  enqueueSnackbar: PropTypes.func\r\n};\r\n\r\nexport default withSnackbar(withLanguage(AnnouncementBar));\r\n"]},"metadata":{},"sourceType":"module"}