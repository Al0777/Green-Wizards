{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\nucle\\\\Documents\\\\GitHub\\\\Families_Share-platform\\\\client\\\\src\\\\components\\\\Calendar.js\";\n\n/* eslint-disable react/prop-types */\nimport React from \"react\";\nimport * as moment from \"moment\";\nimport { withRouter } from \"react-router-dom\";\nimport BigCalendar from \"react-big-calendar\";\nimport PropTypes from \"prop-types\";\nimport axios from \"axios\";\nimport { Swipeable } from \"react-swipeable\";\nimport AgendaView from \"./AgendaView\";\nimport \"../styles/react-big-calendar.css\";\nimport withLanguage from \"./LanguageContext\";\nimport Texts from \"../Constants/Texts\";\nimport Log from \"./Log\";\n\nvar getGroupEvents = function getGroupEvents(groupId) {\n  return axios.get(\"/api/groups/\".concat(groupId, \"/events\")).then(function (response) {\n    return response.data;\n  }).catch(function (error) {\n    Log.error(error);\n    return [];\n  });\n};\n\nvar getUserEvents = function getUserEvents(userId) {\n  return axios.get(\"/api/users/\".concat(userId, \"/events\")).then(function (response) {\n    return response.data;\n  }).catch(function (error) {\n    Log.error(error);\n    return [];\n  });\n};\n\nvar MyAgenda = function MyAgenda(_ref) {\n  var ev = _ref.events,\n      date = _ref.date;\n\n  var getCurrentMonthEvents = function getCurrentMonthEvents() {\n    var events = JSON.parse(JSON.stringify(ev));\n    var currentMonth = moment(date).format(\"MMMM\");\n    var currentYear = moment(date).format(\"YYYY\");\n    var filteredEvents = events.filter(function (event) {\n      return moment(event.start).format(\"MMMM\") === currentMonth && moment(event.start).format(\"YYYY\") === currentYear;\n    });\n    return filteredEvents;\n  };\n\n  return /*#__PURE__*/React.createElement(AgendaView, {\n    events: getCurrentMonthEvents(),\n    activeMonth: moment(date).format(\"MMMM\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 5\n    }\n  });\n};\n\nMyAgenda.title = function (date) {\n  return moment(date).format(\"MMMM YYYY\");\n};\n\nMyAgenda.navigate = function (date, action) {\n  switch (action) {\n    case BigCalendar.Navigate.PREVIOUS:\n      return moment(date).add(-1, \"M\").toDate();\n\n    case BigCalendar.Navigate.NEXT:\n      return moment(date).add(1, \"M\").toDate();\n\n    default:\n      return date;\n  }\n};\n\nvar DayHeader = function DayHeader() {\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 10\n    }\n  });\n};\n\nvar MyMonthEvent = function MyMonthEvent(_ref2) {\n  var event = _ref2.event,\n      history = _ref2.history;\n  var activityId = event.extendedProperties.shared.activityId;\n  var timeslotId = event.id;\n  var groupId = event.extendedProperties.shared.groupId;\n  var pathname = \"/groups/\".concat(groupId, \"/activities/\").concat(activityId, \"/timeslots/\").concat(timeslotId);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    role: \"button\",\n    tabIndex: -42,\n    onClick: function onClick() {\n      return history.push(pathname);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 5\n    }\n  }, event.title);\n};\n\nvar DateCell = function DateCell(_ref3) {\n  var children = _ref3.children;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      backgroundColor: \"#00838f\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 10\n    }\n  }, children);\n};\n\nvar DateHeader = function DateHeader(handleDayClick) {\n  return function (_ref4) {\n    var drilldownView = _ref4.drilldownView,\n        label = _ref4.label,\n        onDrillDown = _ref4.onDrillDown;\n\n    if (!drilldownView) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 12\n        }\n      }, label);\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      role: \"button\",\n      tabIndex: -42,\n      onClick: function onClick(event) {\n        onDrillDown(event);\n        handleDayClick();\n      },\n      style: {\n        cursor: \"pointer\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 5\n      }\n    }, label);\n  };\n};\n\nvar CustomToolbar = function CustomToolbar(handleChangeView, handleMonthEvents, swipe, cancelSwipe, filter, filterActivities, title) {\n  return function (_ref5) {\n    var view = _ref5.view,\n        onView = _ref5.onView,\n        onNavigate = _ref5.onNavigate,\n        date = _ref5.date,\n        label = _ref5.label;\n\n    var changeView = function changeView() {\n      switch (view) {\n        case \"month\":\n          onView(\"agenda\");\n          handleChangeView(\"agenda\");\n          break;\n\n        case \"day\":\n          onView(\"month\");\n          handleChangeView(\"month\");\n          break;\n\n        case \"agenda\":\n          onView(\"month\");\n          handleChangeView(\"month\");\n          break;\n\n        default:\n      }\n    };\n\n    var navigate = function navigate(action) {\n      if (action === \"NEXT\") {\n        var newDate = moment(date).add(1, \"M\").toDate();\n        handleMonthEvents(moment(newDate).format(\"MMMM\"), moment(newDate).format(\"YYYY\"));\n      } else {\n        var _newDate = moment(date).add(-1, \"M\").toDate();\n\n        handleMonthEvents(moment(_newDate).format(\"MMMM\"), moment(_newDate).format(\"YYYY\"));\n      }\n\n      onNavigate(action);\n    };\n\n    if (swipe === \"right\") {\n      cancelSwipe();\n      var newDate = moment(date).add(-1, \"M\").toDate();\n      handleMonthEvents(moment(newDate).format(\"MMMM\"), moment(newDate).format(\"YYYY\"));\n      onNavigate(\"PREV\");\n    } else if (swipe === \"left\") {\n      cancelSwipe();\n\n      var _newDate2 = moment(date).add(1, \"M\").toDate();\n\n      handleMonthEvents(moment(_newDate2).format(\"MMMM\"), moment(_newDate2).format(\"YYYY\"));\n      onNavigate(\"NEXT\");\n    }\n\n    var filterIcon = filter === \"all\" ? \"fas fa-list-ul\" : \"fas fa-tasks\";\n    var icon = \"\";\n\n    switch (view) {\n      case \"agenda\":\n        icon = \"fas fa-clipboard\";\n        break;\n\n      case \"month\":\n        icon = \"fas fa-calendar-alt\";\n        break;\n\n      case \"day\":\n        icon = \"fas fa-calendar-day\";\n        break;\n\n      default:\n    }\n\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"toolbarContainer\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"calendarTitle\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }\n    }, \"\".concat(title))), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"toolbarContainer\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"monthLabelContainer\",\n      className: \"horizontalCenter\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"transparentButton\",\n      onClick: function onClick() {\n        return navigate(\"PREV\");\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-chevron-left\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 11\n      }\n    }, label), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"transparentButton\",\n      onClick: function onClick() {\n        return navigate(\"NEXT\");\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-chevron-right\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"calendarToolbarButtons\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"transparentButton filterActivitiesButton\",\n      onClick: function onClick() {\n        return filter === \"all\" ? filterActivities(\"ongoing\") : filterActivities(\"all\");\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: filterIcon,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"transparentButton toggleViewButton\",\n      onClick: changeView,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: icon,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 13\n      }\n    })))));\n  };\n};\n\nvar Calendar = /*#__PURE__*/function (_React$Component) {\n  _inherits(Calendar, _React$Component);\n\n  var _super = _createSuper(Calendar);\n\n  function Calendar() {\n    var _this2;\n\n    _classCallCheck(this, Calendar);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this2 = _super.call.apply(_super, [this].concat(args));\n    _this2.state = {\n      events: [],\n      swipe: \"none\",\n      filter: \"all\",\n      filteredEvents: []\n    };\n\n    _this2.eventStyleGetter = function (event) {\n      var style = {\n        backgroundColor: event.extendedProperties.shared.activityColor\n      };\n      return {\n        style: style\n      };\n    };\n\n    _this2.dayStyleGetter = function () {\n      var style = {\n        border: \"none\"\n      };\n      return {\n        style: style\n      };\n    };\n\n    _this2.handleMonthEvents = function (currentMonth, currentYear) {\n      var events = _this2.state.events;\n      events.forEach(function (event) {\n        var createdMonth = moment(event.created).month();\n        var createdYear = moment(event.created).format(\"YYYY\");\n\n        if (event.extendedProperties.shared.repetition === \"monthly\") {\n          if (createdYear <= currentYear && createdMonth <= moment().month(currentMonth).format(\"M\")) {\n            event.start = moment(event.start).month(currentMonth).year(currentYear);\n            event.end = moment(event.end).month(currentMonth).year(currentYear);\n          }\n        }\n      });\n\n      _this2.setState({\n        events: events\n      });\n    };\n\n    _this2.swipingLeft = function () {\n      _this2.setState({\n        swipe: \"left\"\n      });\n    };\n\n    _this2.swipingRight = function () {\n      _this2.setState({\n        swipe: \"right\"\n      });\n    };\n\n    _this2.cancelSwipe = function () {\n      _this2.setState({\n        swipe: \"none\"\n      });\n    };\n\n    _this2.handleChangeView = function (view) {\n      _this2.setState({\n        activeView: view\n      });\n    };\n\n    _this2.handleActivitiesFilter = function (filter) {\n      var events = _this2.state.events;\n      var filteredEvents = filter === \"all\" ? events : events.filter(function (event) {\n        return event.extendedProperties.shared.status === \"ongoing\";\n      });\n\n      _this2.setState({\n        filter: filter,\n        filteredEvents: filteredEvents\n      });\n    };\n\n    return _this2;\n  }\n\n  _createClass(Calendar, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this$props, ownerType, ownerId, filter, userEvents, filteredUserEvents, groupEvents, filteredGroupEvents;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$props = this.props, ownerType = _this$props.ownerType, ownerId = _this$props.ownerId;\n                filter = this.state.filter;\n                _context.t0 = ownerType;\n                _context.next = _context.t0 === \"user\" ? 5 : _context.t0 === \"group\" ? 12 : 19;\n                break;\n\n              case 5:\n                _context.next = 7;\n                return getUserEvents(ownerId);\n\n              case 7:\n                userEvents = _context.sent;\n                userEvents.forEach(function (event) {\n                  event.title = event.summary;\n                  event.start = new Date(event.start.dateTime);\n                  event.end = new Date(event.end.dateTime);\n                });\n                filteredUserEvents = filter === \"all\" ? userEvents : userEvents.filter(function (event) {\n                  return event.extendedProperties.shared === \"ongoing\";\n                });\n                this.setState({\n                  events: userEvents,\n                  filteredEvents: filteredUserEvents\n                });\n                return _context.abrupt(\"break\", 21);\n\n              case 12:\n                _context.next = 14;\n                return getGroupEvents(ownerId);\n\n              case 14:\n                groupEvents = _context.sent;\n                groupEvents.forEach(function (event) {\n                  event.title = event.summary;\n                  event.start = new Date(event.start.dateTime);\n                  event.end = new Date(event.end.dateTime);\n                });\n                filteredGroupEvents = filter === \"all\" ? groupEvents : groupEvents.filter(function (event) {\n                  return event.extendedProperties.shared === \"ongoing\";\n                });\n                this.setState({\n                  events: groupEvents,\n                  filteredEvents: filteredGroupEvents\n                });\n                return _context.abrupt(\"break\", 21);\n\n              case 19:\n                this.setState({\n                  events: []\n                });\n                Log.error(\"error\");\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props2 = this.props,\n          language = _this$props2.language,\n          ownerType = _this$props2.ownerType;\n      var _this$state = this.state,\n          swipe = _this$state.swipe,\n          activeView = _this$state.activeView,\n          filteredEvents = _this$state.filteredEvents,\n          filter = _this$state.filter;\n      var texts = Texts[language].calendar;\n      var calendarTitle = ownerType === \"user\" ? texts.userCalendar : texts.groupCalendar;\n      var localizer = BigCalendar.momentLocalizer(moment);\n      var components = {\n        month: {\n          dateHeader: DateHeader(function () {\n            return _this3.handleChangeView(\"day\");\n          }),\n          dateCellWrapper: DateCell,\n          event: withRouter(MyMonthEvent)\n        },\n        day: {\n          header: DayHeader\n        },\n        toolbar: CustomToolbar(this.handleChangeView, this.handleMonthEvents, swipe, this.cancelSwipe, filter, this.handleActivitiesFilter, calendarTitle)\n      };\n      var style = {\n        flex: 1\n      };\n\n      if (activeView === \"day\" && ownerType === \"group\") {\n        style.paddingBottom = \"6rem\";\n      }\n\n      return /*#__PURE__*/React.createElement(Swipeable, {\n        delta: 100,\n        onSwipingLeft: this.swipingLeft,\n        onSwipingRight: this.swipingRight,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: style,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(BigCalendar, {\n        popup: true,\n        style: {\n          minHeight: \"40rem\"\n        },\n        localizer: localizer,\n        events: filteredEvents,\n        views: {\n          month: true,\n          agenda: MyAgenda,\n          day: true\n        },\n        defaultView: BigCalendar.Views.MONTH,\n        startAccessor: \"start\",\n        endAccessor: \"end\",\n        components: components,\n        eventPropGetter: this.eventStyleGetter,\n        dayPropGetter: this.dayStyleGetter,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 11\n        }\n      })));\n    }\n  }]);\n\n  return Calendar;\n}(React.Component);\n\nexport default withRouter(withLanguage(Calendar));\nCalendar.propTypes = {\n  ownerType: PropTypes.string,\n  ownerId: PropTypes.string,\n  language: PropTypes.string\n};\nMyAgenda.propTypes = {\n  events: PropTypes.array,\n  date: PropTypes.instanceOf(Date)\n};\nMyMonthEvent.propTypes = {\n  history: PropTypes.object,\n  event: PropTypes.object\n};\nDateCell.propTypes = {\n  children: PropTypes.node\n};\nDateHeader.propTypes = {\n  drilldownView: PropTypes.bool,\n  onDrillDown: PropTypes.func,\n  label: PropTypes.string\n};\nCustomToolbar.propTypes = {\n  view: PropTypes.string,\n  onView: PropTypes.func,\n  onNavigate: PropTypes.func,\n  date: PropTypes.instanceOf(Date),\n  label: PropTypes.string\n};","map":{"version":3,"sources":["C:/Users/nucle/Documents/GitHub/Families_Share-platform/client/src/components/Calendar.js"],"names":["React","moment","withRouter","BigCalendar","PropTypes","axios","Swipeable","AgendaView","withLanguage","Texts","Log","getGroupEvents","groupId","get","then","response","data","catch","error","getUserEvents","userId","MyAgenda","ev","events","date","getCurrentMonthEvents","JSON","parse","stringify","currentMonth","format","currentYear","filteredEvents","filter","event","start","title","navigate","action","Navigate","PREVIOUS","add","toDate","NEXT","DayHeader","MyMonthEvent","history","activityId","extendedProperties","shared","timeslotId","id","pathname","push","DateCell","children","backgroundColor","DateHeader","handleDayClick","drilldownView","label","onDrillDown","cursor","CustomToolbar","handleChangeView","handleMonthEvents","swipe","cancelSwipe","filterActivities","view","onView","onNavigate","changeView","newDate","filterIcon","icon","Calendar","state","eventStyleGetter","style","activityColor","dayStyleGetter","border","forEach","createdMonth","created","month","createdYear","repetition","year","end","setState","swipingLeft","swipingRight","activeView","handleActivitiesFilter","status","props","ownerType","ownerId","userEvents","summary","Date","dateTime","filteredUserEvents","groupEvents","filteredGroupEvents","language","texts","calendar","calendarTitle","userCalendar","groupCalendar","localizer","momentLocalizer","components","dateHeader","dateCellWrapper","day","header","toolbar","flex","paddingBottom","minHeight","agenda","Views","MONTH","Component","propTypes","string","array","instanceOf","object","node","bool","func"],"mappings":"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","sourcesContent":["/* eslint-disable react/prop-types */\r\nimport React from \"react\";\r\nimport * as moment from \"moment\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport BigCalendar from \"react-big-calendar\";\r\nimport PropTypes from \"prop-types\";\r\nimport axios from \"axios\";\r\nimport { Swipeable } from \"react-swipeable\";\r\nimport AgendaView from \"./AgendaView\";\r\nimport \"../styles/react-big-calendar.css\";\r\nimport withLanguage from \"./LanguageContext\";\r\nimport Texts from \"../Constants/Texts\";\r\nimport Log from \"./Log\";\r\n\r\nconst getGroupEvents = groupId => {\r\n  return axios\r\n    .get(`/api/groups/${groupId}/events`)\r\n    .then(response => {\r\n      return response.data;\r\n    })\r\n    .catch(error => {\r\n      Log.error(error);\r\n      return [];\r\n    });\r\n};\r\n\r\nconst getUserEvents = userId => {\r\n  return axios\r\n    .get(`/api/users/${userId}/events`)\r\n    .then(response => {\r\n      return response.data;\r\n    })\r\n    .catch(error => {\r\n      Log.error(error);\r\n      return [];\r\n    });\r\n};\r\n\r\nconst MyAgenda = ({ events: ev, date }) => {\r\n  const getCurrentMonthEvents = () => {\r\n    const events = JSON.parse(JSON.stringify(ev));\r\n    const currentMonth = moment(date).format(\"MMMM\");\r\n    const currentYear = moment(date).format(\"YYYY\");\r\n    const filteredEvents = events.filter(\r\n      event =>\r\n        moment(event.start).format(\"MMMM\") === currentMonth &&\r\n        moment(event.start).format(\"YYYY\") === currentYear\r\n    );\r\n    return filteredEvents;\r\n  };\r\n  return (\r\n    <AgendaView\r\n      events={getCurrentMonthEvents()}\r\n      activeMonth={moment(date).format(\"MMMM\")}\r\n    />\r\n  );\r\n};\r\nMyAgenda.title = date => {\r\n  return moment(date).format(\"MMMM YYYY\");\r\n};\r\nMyAgenda.navigate = (date, action) => {\r\n  switch (action) {\r\n    case BigCalendar.Navigate.PREVIOUS:\r\n      return moment(date)\r\n        .add(-1, \"M\")\r\n        .toDate();\r\n    case BigCalendar.Navigate.NEXT:\r\n      return moment(date)\r\n        .add(1, \"M\")\r\n        .toDate();\r\n\r\n    default:\r\n      return date;\r\n  }\r\n};\r\n\r\nconst DayHeader = () => {\r\n  return <div />;\r\n};\r\n\r\nconst MyMonthEvent = ({ event, history }) => {\r\n  const { activityId } = event.extendedProperties.shared;\r\n  const timeslotId = event.id;\r\n  const { groupId } = event.extendedProperties.shared;\r\n  const pathname = `/groups/${groupId}/activities/${activityId}/timeslots/${timeslotId}`;\r\n  return (\r\n    <div role=\"button\" tabIndex={-42} onClick={() => history.push(pathname)}>\r\n      {event.title}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst DateCell = ({ children }) => {\r\n  return <div style={{ backgroundColor: \"#00838f\" }}>{children}</div>;\r\n};\r\n\r\nconst DateHeader = handleDayClick => ({\r\n  drilldownView,\r\n  label,\r\n  // eslint-disable-next-line react/prop-types\r\n  onDrillDown\r\n}) => {\r\n  if (!drilldownView) {\r\n    return <span>{label}</span>;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      role=\"button\"\r\n      tabIndex={-42}\r\n      onClick={event => {\r\n        onDrillDown(event);\r\n        handleDayClick();\r\n      }}\r\n      style={{ cursor: \"pointer\" }}\r\n    >\r\n      {label}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst CustomToolbar = (\r\n  handleChangeView,\r\n  handleMonthEvents,\r\n  swipe,\r\n  cancelSwipe,\r\n  filter,\r\n  filterActivities,\r\n  title\r\n) => ({ view, onView, onNavigate, date, label }) => {\r\n  const changeView = () => {\r\n    switch (view) {\r\n      case \"month\":\r\n        onView(\"agenda\");\r\n        handleChangeView(\"agenda\");\r\n        break;\r\n      case \"day\":\r\n        onView(\"month\");\r\n        handleChangeView(\"month\");\r\n        break;\r\n      case \"agenda\":\r\n        onView(\"month\");\r\n        handleChangeView(\"month\");\r\n        break;\r\n      default:\r\n    }\r\n  };\r\n  const navigate = action => {\r\n    if (action === \"NEXT\") {\r\n      const newDate = moment(date)\r\n        .add(1, \"M\")\r\n        .toDate();\r\n      handleMonthEvents(\r\n        moment(newDate).format(\"MMMM\"),\r\n        moment(newDate).format(\"YYYY\")\r\n      );\r\n    } else {\r\n      const newDate = moment(date)\r\n        .add(-1, \"M\")\r\n        .toDate();\r\n      handleMonthEvents(\r\n        moment(newDate).format(\"MMMM\"),\r\n        moment(newDate).format(\"YYYY\")\r\n      );\r\n    }\r\n    onNavigate(action);\r\n  };\r\n  if (swipe === \"right\") {\r\n    cancelSwipe();\r\n    const newDate = moment(date)\r\n      .add(-1, \"M\")\r\n      .toDate();\r\n    handleMonthEvents(\r\n      moment(newDate).format(\"MMMM\"),\r\n      moment(newDate).format(\"YYYY\")\r\n    );\r\n    onNavigate(\"PREV\");\r\n  } else if (swipe === \"left\") {\r\n    cancelSwipe();\r\n    const newDate = moment(date)\r\n      .add(1, \"M\")\r\n      .toDate();\r\n    handleMonthEvents(\r\n      moment(newDate).format(\"MMMM\"),\r\n      moment(newDate).format(\"YYYY\")\r\n    );\r\n    onNavigate(\"NEXT\");\r\n  }\r\n  const filterIcon = filter === \"all\" ? \"fas fa-list-ul\" : \"fas fa-tasks\";\r\n  let icon = \"\";\r\n  switch (view) {\r\n    case \"agenda\":\r\n      icon = \"fas fa-clipboard\";\r\n      break;\r\n    case \"month\":\r\n      icon = \"fas fa-calendar-alt\";\r\n      break;\r\n    case \"day\":\r\n      icon = \"fas fa-calendar-day\";\r\n      break;\r\n    default:\r\n  }\r\n  return (\r\n    <React.Fragment>\r\n      <div id=\"toolbarContainer\">\r\n        <div id=\"calendarTitle\">{`${title}`}</div>\r\n      </div>\r\n      <div id=\"toolbarContainer\">\r\n        <div id=\"monthLabelContainer\" className=\"horizontalCenter\">\r\n          <button\r\n            type=\"button\"\r\n            className=\"transparentButton\"\r\n            onClick={() => navigate(\"PREV\")}\r\n          >\r\n            <i className=\"fas fa-chevron-left\" />\r\n          </button>\r\n          <span>{label}</span>\r\n          <button\r\n            type=\"button\"\r\n            className=\"transparentButton\"\r\n            onClick={() => navigate(\"NEXT\")}\r\n          >\r\n            <i className=\"fas fa-chevron-right\" />\r\n          </button>\r\n        </div>\r\n        <div className=\"calendarToolbarButtons\">\r\n          <button\r\n            type=\"button\"\r\n            className=\"transparentButton filterActivitiesButton\"\r\n            onClick={() =>\r\n              filter === \"all\"\r\n                ? filterActivities(\"ongoing\")\r\n                : filterActivities(\"all\")\r\n            }\r\n          >\r\n            <i className={filterIcon} />\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            className=\"transparentButton toggleViewButton\"\r\n            onClick={changeView}\r\n          >\r\n            <i className={icon} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nclass Calendar extends React.Component {\r\n  state = { events: [], swipe: \"none\", filter: \"all\", filteredEvents: [] };\r\n\r\n  async componentDidMount() {\r\n    const { ownerType, ownerId } = this.props;\r\n    const { filter } = this.state;\r\n    switch (ownerType) {\r\n      case \"user\":\r\n        const userEvents = await getUserEvents(ownerId);\r\n        userEvents.forEach(event => {\r\n          event.title = event.summary;\r\n          event.start = new Date(event.start.dateTime);\r\n          event.end = new Date(event.end.dateTime);\r\n        });\r\n        const filteredUserEvents =\r\n          filter === \"all\"\r\n            ? userEvents\r\n            : userEvents.filter(\r\n                event => event.extendedProperties.shared === \"ongoing\"\r\n              );\r\n        this.setState({\r\n          events: userEvents,\r\n          filteredEvents: filteredUserEvents\r\n        });\r\n        break;\r\n      case \"group\":\r\n        const groupEvents = await getGroupEvents(ownerId);\r\n        groupEvents.forEach(event => {\r\n          event.title = event.summary;\r\n          event.start = new Date(event.start.dateTime);\r\n          event.end = new Date(event.end.dateTime);\r\n        });\r\n        const filteredGroupEvents =\r\n          filter === \"all\"\r\n            ? groupEvents\r\n            : groupEvents.filter(\r\n                event => event.extendedProperties.shared === \"ongoing\"\r\n              );\r\n        this.setState({\r\n          events: groupEvents,\r\n          filteredEvents: filteredGroupEvents\r\n        });\r\n        break;\r\n      default:\r\n        this.setState({ events: [] });\r\n        Log.error(\"error\");\r\n    }\r\n  }\r\n\r\n  eventStyleGetter = event => {\r\n    const style = {\r\n      backgroundColor: event.extendedProperties.shared.activityColor\r\n    };\r\n    return {\r\n      style\r\n    };\r\n  };\r\n\r\n  dayStyleGetter = () => {\r\n    const style = {\r\n      border: \"none\"\r\n    };\r\n    return {\r\n      style\r\n    };\r\n  };\r\n\r\n  handleMonthEvents = (currentMonth, currentYear) => {\r\n    const { events } = this.state;\r\n    events.forEach(event => {\r\n      const createdMonth = moment(event.created).month();\r\n      const createdYear = moment(event.created).format(\"YYYY\");\r\n      if (event.extendedProperties.shared.repetition === \"monthly\") {\r\n        if (\r\n          createdYear <= currentYear &&\r\n          createdMonth <=\r\n            moment()\r\n              .month(currentMonth)\r\n              .format(\"M\")\r\n        ) {\r\n          event.start = moment(event.start)\r\n            .month(currentMonth)\r\n            .year(currentYear);\r\n          event.end = moment(event.end)\r\n            .month(currentMonth)\r\n            .year(currentYear);\r\n        }\r\n      }\r\n    });\r\n    this.setState({ events });\r\n  };\r\n\r\n  swipingLeft = () => {\r\n    this.setState({ swipe: \"left\" });\r\n  };\r\n\r\n  swipingRight = () => {\r\n    this.setState({ swipe: \"right\" });\r\n  };\r\n\r\n  cancelSwipe = () => {\r\n    this.setState({ swipe: \"none\" });\r\n  };\r\n\r\n  handleChangeView = view => {\r\n    this.setState({ activeView: view });\r\n  };\r\n\r\n  handleActivitiesFilter = filter => {\r\n    const { events } = this.state;\r\n    const filteredEvents =\r\n      filter === \"all\"\r\n        ? events\r\n        : events.filter(\r\n            event => event.extendedProperties.shared.status === \"ongoing\"\r\n          );\r\n    this.setState({ filter, filteredEvents });\r\n  };\r\n\r\n  render() {\r\n    const { language, ownerType } = this.props;\r\n    const { swipe, activeView, filteredEvents, filter } = this.state;\r\n    const texts = Texts[language].calendar;\r\n    const calendarTitle =\r\n      ownerType === \"user\" ? texts.userCalendar : texts.groupCalendar;\r\n    const localizer = BigCalendar.momentLocalizer(moment);\r\n    const components = {\r\n      month: {\r\n        dateHeader: DateHeader(() => this.handleChangeView(\"day\")),\r\n        dateCellWrapper: DateCell,\r\n        event: withRouter(MyMonthEvent)\r\n      },\r\n      day: { header: DayHeader },\r\n      toolbar: CustomToolbar(\r\n        this.handleChangeView,\r\n        this.handleMonthEvents,\r\n        swipe,\r\n        this.cancelSwipe,\r\n        filter,\r\n        this.handleActivitiesFilter,\r\n        calendarTitle\r\n      )\r\n    };\r\n    const style = { flex: 1 };\r\n    if (activeView === \"day\" && ownerType === \"group\") {\r\n      style.paddingBottom = \"6rem\";\r\n    }\r\n    return (\r\n      <Swipeable\r\n        delta={100}\r\n        onSwipingLeft={this.swipingLeft}\r\n        onSwipingRight={this.swipingRight}\r\n      >\r\n        <div style={style}>\r\n          <BigCalendar\r\n            popup\r\n            style={{ minHeight: \"40rem\" }}\r\n            localizer={localizer}\r\n            events={filteredEvents}\r\n            views={{ month: true, agenda: MyAgenda, day: true }}\r\n            defaultView={BigCalendar.Views.MONTH}\r\n            startAccessor=\"start\"\r\n            endAccessor=\"end\"\r\n            components={components}\r\n            eventPropGetter={this.eventStyleGetter}\r\n            dayPropGetter={this.dayStyleGetter}\r\n          />\r\n        </div>\r\n      </Swipeable>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(withLanguage(Calendar));\r\n\r\nCalendar.propTypes = {\r\n  ownerType: PropTypes.string,\r\n  ownerId: PropTypes.string,\r\n  language: PropTypes.string\r\n};\r\n\r\nMyAgenda.propTypes = {\r\n  events: PropTypes.array,\r\n  date: PropTypes.instanceOf(Date)\r\n};\r\n\r\nMyMonthEvent.propTypes = {\r\n  history: PropTypes.object,\r\n  event: PropTypes.object\r\n};\r\n\r\nDateCell.propTypes = {\r\n  children: PropTypes.node\r\n};\r\n\r\nDateHeader.propTypes = {\r\n  drilldownView: PropTypes.bool,\r\n  onDrillDown: PropTypes.func,\r\n  label: PropTypes.string\r\n};\r\n\r\nCustomToolbar.propTypes = {\r\n  view: PropTypes.string,\r\n  onView: PropTypes.func,\r\n  onNavigate: PropTypes.func,\r\n  date: PropTypes.instanceOf(Date),\r\n  label: PropTypes.string\r\n};\r\n"]},"metadata":{},"sourceType":"module"}